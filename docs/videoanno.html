<!DOCTYPE html>  <html> <head>   <title>videoanno.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               videoanno.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>OAC Video Annotation Tool v0.1</p>

<p>The <strong>OAC Video Annotation Tool</strong> is a MITHGrid application providing annotation capabilities for streaming
video embedded in a web page. </p>

<p>Date: Thu Mar 29 13:15:17 2012 -0400</p>

<p>Educational Community License, Version 2.0</p>

<p>Copyright 2011 University of Maryland. Licensed under the Educational
Community License, Version 2.0 (the "License"); you may not use this file
except in compliance with the License. You may obtain a copy of the License at</p>

<p>http://www.osedu.org/licenses/ECL-2.0</p>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations under
the License.</p>

<p>Author: Grant Dickie</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>Initialization</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>We make sure certain globals are defined in case this library is loaded before MITHGrid,
jQuery, or RaphaÃ«l.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MITHGrid</span> <span class="o">=</span> <span class="nx">MITHGrid</span> <span class="o">||</span> <span class="p">{};</span>
<span class="kd">var</span> <span class="nx">jQuery</span> <span class="o">=</span> <span class="nx">jQuery</span> <span class="o">||</span> <span class="p">{};</span>
<span class="kd">var</span> <span class="nx">Raphael</span> <span class="o">=</span> <span class="nx">Raphael</span> <span class="o">||</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>The plugin uses the OAC.Client.StreamingVideo namespace.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">OAC</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">globalNamespace</span><span class="p">(</span><span class="s2">&quot;OAC&quot;</span><span class="p">);</span>
<span class="nx">OAC</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;Client&quot;</span><span class="p">);</span>
<span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;StreamingVideo&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h1>Controllers</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">MITHGrid</span><span class="p">,</span> <span class="nx">OAC</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">Controller</span> <span class="o">=</span> <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;Controller&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h2>KeyboardListener</h2>

<p>OAC.Client.StreamingVideo.Controller.KeyboardListener listens to keydown events on the DOM document
level and translates them into delete events.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Controller</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;KeyboardListener&quot;</span><span class="p">);</span>
    </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h3>KeyboardListener.initController</h3>

<p>Parameters:</p>

<ul>
<li>options - object holding configuration options for the KeyboardListener object</li>
</ul>

<p>Returns:</p>

<p>The configured KeyboardListener controller.</p>

<p>Options:</p>

<ul>
<li>application - the application using this controller</li>
<li>isAction - a function which returns true if keyboard events should be propagated</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Controller</span><span class="p">.</span><span class="nx">KeyboardListener</span><span class="p">.</span><span class="nx">initController</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">initController</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.KeyboardListener&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>

        <span class="nx">that</span><span class="p">.</span><span class="nx">applyBindings</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">binding</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">),</span>
            <span class="nx">activeId</span><span class="p">;</span>

            <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onActiveAnnotationChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">activeId</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
            <span class="p">});</span>

            <span class="nx">$</span><span class="p">(</span><span class="nx">doc</span><span class="p">).</span><span class="nx">keydown</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">getCurrentMode</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;Editing&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">activeId</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">activeId</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>If backspace or delete is pressed,
then it is interpreted as a
delete call.</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">8</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">46</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onDelete</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">activeId</span><span class="p">);</span>
                        <span class="nx">activeId</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>AnnotationEditSelectionGrid</h2>

<p>Attaches to an SVG lens and creates a green rectangle dashed box to
act as the resize and drag tool. Only edits the SVG data - no annotation
bodyContent data.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Controller</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;AnnotationEditSelectionGrid&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3>AnnotationEditSelectionGrid.initController</h3>

<p>Initializes the AnnotationEditSelectionGrid controller object. This object may then be used to bind actions to
the DOM.</p>

<p>We create the bounding box once and keep it around. We then track which rendering is associated with
the bounding box and draw it accordingly.
We associate the bounding box with the SVG/RaphaÃ«l canvas holding the renderings we want to use it with.</p>

<p>Each RaphaÃ«l canvas should have its own AnnotationEditSelectionGrid instance for binding renderings.</p>

<p>Parameters:</p>

<ul>
<li>options - object holding configuration information</li>
</ul>

<p>Returns:</p>

<p>The initialized controller object.</p>

<p>FIXME:</p>

<p>The controller needs to be broken up a bit. The idea of providing a bounding box for renderings is something that
should be handled in the presentation, not here. The controller should just generate events based on user interactions.
The presentation should worry about which rendering is currently active and manage the translation of controller
events to the rendering.</p>

<p>For now, we'll refactor this into two pieces: the bounding box drawing (rendering), and translating events in the binding.</p>

<p>We will eventually split this controller into two: bounding box resize controller and bounding box drag/move controller.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Controller</span><span class="p">.</span><span class="nx">AnnotationEditSelectionGrid</span><span class="p">.</span><span class="nx">initController</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">initController</span><span class="p">(</span>
        <span class="s2">&quot;OAC.Client.StreamingVideo.Controller.AnnotationEditSelectionGrid&quot;</span><span class="p">,</span>
        <span class="nx">options</span>
        <span class="p">),</span>
        <span class="nx">dirs</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="nx">options</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>
        <span class="nx">dirs</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">dirs</span><span class="p">;</span> <span class="c1">// || [&#39;ul&#39;, &#39;top&#39;, &#39;ur&#39;, &#39;lft&#39;, &#39;lr&#39;, &#39;btm&#39;, &#39;ll&#39;, &#39;rgt&#39;, &#39;mid&#39;];</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h4>AnnotationEditSelectionGrid #applyBindings</h4>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">that</span><span class="p">.</span><span class="nx">applyBindings</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">binding</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ox</span><span class="p">,</span>
            <span class="nx">oy</span><span class="p">,</span>
            <span class="nx">handleSet</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">midDrag</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">svgBBox</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">itemMenu</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">handles</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">activeRendering</span><span class="p">,</span>
            <span class="nx">deleteButton</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">editButton</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">menuContainer</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">factors</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">extents</span><span class="p">,</span>
            <span class="nx">paper</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">paper</span><span class="p">,</span>
            <span class="nx">attrs</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">padding</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
            <span class="nx">calcFactors</span><span class="p">,</span>
            <span class="nx">calcHandles</span><span class="p">,</span>
            <span class="nx">drawMenu</span><span class="p">,</span>
            <span class="nx">itemDeleted</span><span class="p">,</span>
            <span class="nx">handleIds</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">drawHandles</span><span class="p">,</span>
            <span class="nx">handleAttrs</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">shapeAttrs</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">menuAttrs</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">cursor</span><span class="p">,</span>
            <span class="nx">dAttrs</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">eAttrs</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">handleCalculationData</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">el</span><span class="p">;</span>

            <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onResize</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">pos</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">activeRendering</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">activeRendering</span><span class="p">.</span><span class="nx">eventResize</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">activeRendering</span><span class="p">.</span><span class="nx">eventResize</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onMove</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">pos</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">activeRendering</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">activeRendering</span><span class="p">.</span><span class="nx">eventMove</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">activeRendering</span><span class="p">.</span><span class="nx">eventMove</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onDelete</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">activeRendering</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">activeRendering</span><span class="p">.</span><span class="nx">eventDelete</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">activeRendering</span><span class="p">.</span><span class="nx">eventDelete</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
                    <span class="nx">binding</span><span class="p">.</span><span class="nx">detachRendering</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onCurrentModeChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">newMode</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">newMode</span> <span class="o">!==</span> <span class="s1">&#39;Select&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">newMode</span> <span class="o">!==</span> <span class="s1">&#39;Drag&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">binding</span><span class="p">.</span><span class="nx">detachRendering</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Function for applying a new shape to the bounding box</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">binding</span><span class="p">.</span><span class="nx">attachRendering</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newRendering</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">binding</span><span class="p">.</span><span class="nx">detachRendering</span><span class="p">();</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">newRendering</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>register the rendering</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">activeRendering</span> <span class="o">=</span> <span class="nx">newRendering</span><span class="p">;</span>
                <span class="nx">calcFactors</span><span class="p">();</span>
                <span class="nx">drawHandles</span><span class="p">();</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Function to call in order to "de-activate" the edit box
(i.e. make it hidden)</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">binding</span><span class="p">.</span><span class="nx">detachRendering</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">handleSet</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">activeRendering</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
                <span class="nx">handleSet</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>

                <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
                <span class="nx">midDrag</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">itemMenu</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">itemMenu</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">};</span>
            </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h5>calcFactors (private)</h5>

<p>Measures where the handles should be on mousemove.</p>

<p>Parameters: None.</p>

<p>Returns: Nothing.</p>

<p>FIXME: activeRendering management needs to be in the presentation hosting the bounding box rendering.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">calcFactors</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">extents</span> <span class="o">=</span> <span class="nx">activeRendering</span><span class="p">.</span><span class="nx">getExtents</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>create offset factors for
bounding box
calculate width - height to be larger
than shape</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">padding</span><span class="p">);</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">height</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">padding</span><span class="p">);</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">/</span> <span class="mi">8</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">/</span> <span class="mi">8</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
                <span class="nx">calcHandles</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">itemMenu</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">drawMenu</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h4>drawHandles (private)</h4>

<p>Draws the handles defined in dirs as SVG rectangles and draws the SVG bounding box</p>

<p>Parameters: None.</p>

<p>Returns: Nothing.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">drawHandles</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">handleSet</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>draw the corner and mid-point squares</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">handleSet</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">set</span><span class="p">();</span>
                    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">handles</span><span class="p">,</span>
                    <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">h</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="s1">&#39;mid&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">midDrag</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">padding</span><span class="p">,</span> <span class="nx">padding</span><span class="p">);</span>
                            <span class="nx">o</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">midDrag</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">h</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">padding</span><span class="p">,</span> <span class="nx">padding</span><span class="p">);</span>
                            <span class="nx">o</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">h</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

                            <span class="nx">h</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                                <span class="nx">cursor</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">cursor</span>
                            <span class="p">});</span>
                            <span class="nx">handleSet</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">h</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>make them all similar looking</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">handleSet</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                        <span class="nx">fill</span><span class="o">:</span> <span class="mi">990000</span><span class="p">,</span>
                        <span class="nx">stroke</span><span class="o">:</span> <span class="s1">&#39;black&#39;</span>
                    <span class="p">});</span>

                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">midDrag</span><span class="p">)))</span> <span class="p">{</span>
                        <span class="nx">midDrag</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                            <span class="nx">fill</span><span class="o">:</span> <span class="mi">990000</span><span class="p">,</span>
                            <span class="nx">stroke</span><span class="o">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                            <span class="nx">cursor</span><span class="o">:</span> <span class="s1">&#39;move&#39;</span>
                        <span class="p">});</span>
                    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>drawing bounding box</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">svgBBox</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
                    <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                        <span class="nx">stroke</span><span class="o">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;stroke-dasharray&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;--&quot;</span><span class="p">]</span>
                    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Draw the accompanying menu that sits at top-right corner</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">drawMenu</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">midDrag</span><span class="p">)))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Attaching listener to drag-only handle (midDrag)</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">midDrag</span><span class="p">.</span><span class="nx">drag</span><span class="p">(</span>
                        <span class="kd">function</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>dragging means that the svgBBox stays padding-distance
away from the lens' shape and the lens shape gets updated
in dataStore</p>             </td>             <td class="code">               <div class="highlight"><pre>                            <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">;</span>
                            <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">dy</span><span class="p">;</span>
                            <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">;</span>
                            <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">dy</span><span class="p">;</span>

                            <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                                <span class="nx">x</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span><span class="p">,</span>
                                <span class="nx">y</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span>
                            <span class="p">});</span>

                            <span class="nx">calcHandles</span><span class="p">({</span>
                                <span class="nx">x</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span><span class="p">,</span>
                                <span class="nx">y</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span><span class="p">,</span>
                                <span class="nx">width</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
                                <span class="nx">height</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
                            <span class="p">});</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">itemMenu</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">drawMenu</span><span class="p">({</span>
                                    <span class="nx">x</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span><span class="p">,</span>
                                    <span class="nx">y</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span><span class="p">,</span>
                                    <span class="nx">width</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
                                    <span class="nx">height</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
                                <span class="p">});</span>
                            <span class="p">}</span>
                        <span class="p">},</span>
                        <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>start</p>             </td>             <td class="code">               <div class="highlight"><pre>                            <span class="nx">ox</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">layerX</span><span class="p">;</span>
                            <span class="nx">oy</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">layerY</span><span class="p">;</span>
                            <span class="nx">calcFactors</span><span class="p">();</span>
                            <span class="nx">activeRendering</span><span class="p">.</span><span class="nx">shape</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                                <span class="nx">cursor</span><span class="o">:</span> <span class="s1">&#39;move&#39;</span>
                            <span class="p">});</span>
                        <span class="p">},</span>
                        <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>end</p>             </td>             <td class="code">               <div class="highlight"><pre>                            <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="nx">x</span><span class="o">:</span> <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
                                <span class="nx">y</span><span class="o">:</span> <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">y</span>
                            <span class="p">};</span>

                            <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onMove</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">activeRendering</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
                            <span class="nx">activeRendering</span><span class="p">.</span><span class="nx">shape</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                                <span class="nx">cursor</span><span class="o">:</span> <span class="s1">&#39;default&#39;</span>
                            <span class="p">});</span>
                        <span class="p">}</span>
                        <span class="p">);</span>
                    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Attaching drag and resize handlers</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">handleSet</span><span class="p">.</span><span class="nx">drag</span><span class="p">(</span>
                    <span class="kd">function</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>onmove function - handles dragging
dragging here means that the shape is being resized;
the factorial determines in which direction the
shape is pulled</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="nx">dx</span> <span class="o">*</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
                        <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">height</span> <span class="o">+</span> <span class="nx">dy</span> <span class="o">*</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
                        <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nw</span> <span class="o">=</span> <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">+</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
                        <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nh</span> <span class="o">=</span> <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">+</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
                        <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span> <span class="o">=</span> <span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
                        <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span> <span class="o">=</span> <span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nh</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

                        <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                            <span class="nx">x</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span><span class="p">,</span>
                            <span class="nx">y</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span><span class="p">,</span>
                            <span class="nx">width</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nw</span><span class="p">,</span>
                            <span class="nx">height</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nh</span>
                        <span class="p">});</span>
                        <span class="nx">calcHandles</span><span class="p">({</span>
                            <span class="nx">x</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span><span class="p">,</span>
                            <span class="nx">y</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span><span class="p">,</span>
                            <span class="nx">width</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nw</span><span class="p">,</span>
                            <span class="nx">height</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nh</span>
                        <span class="p">});</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">itemMenu</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">drawMenu</span><span class="p">({</span>
                                <span class="nx">x</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span><span class="p">,</span>
                                <span class="nx">y</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span><span class="p">,</span>
                                <span class="nx">width</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nw</span><span class="p">,</span>
                                <span class="nx">height</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nh</span>
                            <span class="p">});</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>onstart function</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="kd">var</span> <span class="nx">px</span><span class="p">,</span>
                        <span class="nx">py</span><span class="p">;</span>
                        <span class="nx">extents</span> <span class="o">=</span> <span class="nx">activeRendering</span><span class="p">.</span><span class="nx">getExtents</span><span class="p">();</span>
                        <span class="nx">ox</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">layerX</span><span class="p">;</span>
                        <span class="nx">oy</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">layerY</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>change mode</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">setCurrentMode</span><span class="p">(</span><span class="s1">&#39;Drag&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>extents: x, y, width, height</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">px</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="nx">ox</span> <span class="o">-</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
                        <span class="nx">py</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="nx">oy</span> <span class="o">-</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">/</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">px</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">factors</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">px</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">factors</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">factors</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">py</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">factors</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">py</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">factors</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">factors</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="nx">calcFactors</span><span class="p">();</span>
                    <span class="p">},</span>
                    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>onend function
update</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="nx">width</span><span class="o">:</span> <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span>
                            <span class="nx">height</span><span class="o">:</span> <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">h</span>
                        <span class="p">};</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">activeRendering</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onResize</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">activeRendering</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
                        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>change mode back</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">setCurrentMode</span><span class="p">(</span><span class="s1">&#39;Select&#39;</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>show all the boxes and
handles</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>adjust the SvgBBox to be around new
shape</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
                        <span class="nx">width</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
                        <span class="nx">height</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
                    <span class="p">});</span>
                    <span class="nx">handleSet</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
                    <span class="nx">midDrag</span><span class="p">.</span><span class="nx">show</span><span class="p">().</span><span class="nx">toFront</span><span class="p">();</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">itemMenu</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">itemMenu</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
                        <span class="nx">drawMenu</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <h4>drawMenu (private)</h4>

<p>Draws menu that sits at the top-right corner of the shape.</p>

<p>Parameters:</p>

<ul>
<li>args - object holding the .x, .y, and .width properties</li>
</ul>

<p>Returns: Nothing.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">drawMenu</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">itemMenu</span><span class="p">))</span> <span class="p">{</span>

                    <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
                    <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
                    <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
                    <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Create separate attribute objects
for each menu button/container</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">eAttrs</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="nx">w</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span>
                        <span class="nx">h</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">-</span> <span class="p">(</span><span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span>
                    <span class="p">};</span>

                    <span class="nx">dAttrs</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="p">(</span><span class="nx">eAttrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">eAttrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="nx">w</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span>
                        <span class="nx">h</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">-</span> <span class="p">(</span><span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span>
                    <span class="p">};</span>

                    <span class="nx">itemMenu</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">set</span><span class="p">();</span>
                    <span class="nx">menuContainer</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">h</span><span class="p">);</span>
                    <span class="nx">menuContainer</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                        <span class="nx">fill</span><span class="o">:</span> <span class="s1">&#39;#FFFFFF&#39;</span><span class="p">,</span>
                        <span class="nx">stroke</span><span class="o">:</span> <span class="s1">&#39;#000&#39;</span>
                    <span class="p">});</span>

                    <span class="nx">itemMenu</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">menuContainer</span><span class="p">);</span>

                    <span class="nx">editButton</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">eAttrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">eAttrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">eAttrs</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="nx">eAttrs</span><span class="p">.</span><span class="nx">h</span><span class="p">);</span>
                    <span class="nx">editButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                        <span class="nx">fill</span><span class="o">:</span> <span class="mi">334009</span><span class="p">,</span>
                        <span class="nx">cursor</span><span class="o">:</span> <span class="s1">&#39;pointer&#39;</span>
                    <span class="p">});</span>

                    <span class="nx">itemMenu</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">editButton</span><span class="p">);</span>

                    <span class="nx">deleteButton</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">dAttrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">dAttrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">dAttrs</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="nx">dAttrs</span><span class="p">.</span><span class="nx">h</span><span class="p">);</span>
                    <span class="nx">deleteButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                        <span class="nx">fill</span><span class="o">:</span> <span class="mi">334009</span><span class="p">,</span>
                        <span class="nx">cursor</span><span class="o">:</span> <span class="s1">&#39;pointer&#39;</span>
                    <span class="p">});</span>

                    <span class="nx">itemMenu</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">deleteButton</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>attach event firers</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">editButton</span><span class="p">.</span><span class="nx">mousedown</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">activeRendering</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onEdit</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">activeRendering</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
                    <span class="nx">editButton</span><span class="p">.</span><span class="nx">hover</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="nx">editButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                            <span class="nx">fill</span><span class="o">:</span> <span class="mi">443009</span>
                        <span class="p">});</span>
                    <span class="p">},</span>
                    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="nx">editButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                            <span class="nx">fill</span><span class="o">:</span> <span class="mi">334009</span>
                        <span class="p">});</span>
                    <span class="p">});</span>


                    <span class="nx">deleteButton</span><span class="p">.</span><span class="nx">mousedown</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">activeRendering</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onDelete</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">activeRendering</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                            <span class="nx">itemDeleted</span><span class="p">();</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
                    <span class="nx">deleteButton</span><span class="p">.</span><span class="nx">hover</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="nx">deleteButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                            <span class="nx">fill</span><span class="o">:</span> <span class="mi">443009</span>
                        <span class="p">});</span>
                    <span class="p">},</span>
                    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="nx">deleteButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                            <span class="nx">fill</span><span class="o">:</span> <span class="mi">334009</span>
                        <span class="p">});</span>
                    <span class="p">});</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>


                    <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
                    <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>

                    <span class="nx">eAttrs</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="p">(</span><span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="p">(</span><span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="p">};</span>

                    <span class="nx">dAttrs</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="p">(</span><span class="nx">eAttrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">editButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">2</span>
                    <span class="p">};</span>
                    <span class="nx">menuContainer</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span>
                    <span class="p">});</span>
                    <span class="nx">editButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">eAttrs</span><span class="p">);</span>
                    <span class="nx">deleteButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">dAttrs</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="nx">itemDeleted</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>set rendering to undefined</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">binding</span><span class="p">.</span><span class="nx">detachRendering</span><span class="p">();</span>
                <span class="nx">activeRendering</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>

                <span class="nx">itemMenu</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
                <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
                <span class="nx">handleSet</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
                <span class="nx">midDrag</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
            <span class="p">};</span>

            <span class="nx">handleCalculationData</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">ul</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;nw&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="nx">top</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="nx">ur</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;ne&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="nx">rgt</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="nx">lr</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;se&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="nx">btm</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="nx">ll</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="nx">lft</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="nx">mid</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;pointer&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Goes through handle object array and 
sets each handle box coordinate</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">calcHandles</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>calculate where the resize handles
will be located</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="kd">var</span> <span class="nx">calcHandle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">xn</span><span class="p">,</span> <span class="nx">xp</span><span class="p">,</span> <span class="nx">yn</span><span class="p">,</span> <span class="nx">yp</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="p">{</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="nx">args</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">xn</span> <span class="o">*</span> <span class="nx">args</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">xp</span> <span class="o">*</span> <span class="nx">padding</span><span class="p">,</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="nx">args</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">yn</span> <span class="o">*</span> <span class="nx">args</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">yp</span> <span class="o">*</span> <span class="nx">padding</span><span class="p">,</span>
                        <span class="nx">cursor</span><span class="o">:</span> <span class="nx">type</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">?</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">type</span> <span class="o">+</span> <span class="s2">&quot;-resize&quot;</span>
                    <span class="p">};</span>
                <span class="p">},</span>
                <span class="nx">recalcHandle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">info</span><span class="p">,</span> <span class="nx">xn</span><span class="p">,</span> <span class="nx">xp</span><span class="p">,</span> <span class="nx">yn</span><span class="p">,</span> <span class="nx">yp</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">el</span><span class="p">;</span>
                    <span class="nx">info</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">xn</span> <span class="o">*</span> <span class="nx">args</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">xp</span> <span class="o">*</span> <span class="nx">padding</span><span class="p">;</span>
                    <span class="nx">info</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">yn</span> <span class="o">*</span> <span class="nx">args</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">yp</span> <span class="o">*</span> <span class="nx">padding</span><span class="p">;</span>
                    <span class="nx">el</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">getById</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                    <span class="nx">el</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="nx">info</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="nx">info</span><span class="p">.</span><span class="nx">y</span>
                    <span class="p">});</span>
                <span class="p">};</span>
                <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">dirs</span><span class="p">,</span>
                <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">handleCalculationData</span><span class="p">[</span><span class="nx">o</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">handles</span><span class="p">[</span><span class="nx">o</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">handles</span><span class="p">[</span><span class="nx">o</span><span class="p">]</span> <span class="o">=</span> <span class="nx">calcHandle</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">recalcHandle</span><span class="p">(</span><span class="nx">handles</span><span class="p">[</span><span class="nx">o</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">};</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <h2>ShapeCreateBox</h2>

<p>Similar to the Edit bounding box, but displays differently
and listens for events from canvasClickController in "create" mode</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Controller</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;ShapeCreateBox&#39;</span><span class="p">);</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">ShapeCreateBox</span><span class="p">.</span><span class="nx">initController</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">initController</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.ShapeCreateBox&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>

        <span class="nx">that</span><span class="p">.</span><span class="nx">applyBindings</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">binding</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Bounding box is created once in memory - it should be bound to the
canvas/paper object or something that contains more than 1 shape.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">ox</span><span class="p">,</span>
            <span class="nx">oy</span><span class="p">,</span>
            <span class="nx">svgBBox</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">activeRendering</span><span class="p">,</span>
            <span class="nx">factors</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">paper</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">paper</span><span class="p">,</span>
            <span class="nx">attrs</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">padding</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
            <span class="nx">drawMenu</span><span class="p">,</span>
            <span class="nx">itemDeleted</span><span class="p">,</span>
            <span class="nx">shapeAttrs</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">cursor</span><span class="p">,</span>
            <span class="nx">el</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Creates the SVGBBOX which acts as a guide to the user 
of how big their shape will be once shapeDone is fired</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">binding</span><span class="p">.</span><span class="nx">createGuide</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">coords</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>coordinates are top x,y values</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="p">(</span><span class="nx">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">padding</span><span class="p">);</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="p">(</span><span class="nx">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">padding</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">svgBBox</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">svgBBox</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
                    <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                        <span class="nx">stroke</span><span class="o">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;stroke-dasharray&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;--&quot;</span><span class="p">]</span>
                    <span class="p">});</span>

                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>show all the boxes and
handles</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>adjust the SvgBBox to be around new
shape</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
                        <span class="nx">width</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
                        <span class="nx">height</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
                    <span class="p">});</span>
                <span class="p">}</span>

            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Take passed x,y coords and set as bottom-right, not
top left</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">binding</span><span class="p">.</span><span class="nx">resizeGuide</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">coords</span><span class="p">)</span> <span class="p">{</span>

                <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="p">(</span><span class="nx">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="p">(</span><span class="nx">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>

                <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                    <span class="nx">width</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
                    <span class="nx">height</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
                <span class="p">});</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Take the saved coordinates and pass them back 
to the calling function</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">binding</span><span class="p">.</span><span class="nx">completeShape</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">coords</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>

                <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                    <span class="nx">width</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
                    <span class="nx">height</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
                <span class="p">});</span>
                <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="nx">x</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
                    <span class="nx">y</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
                    <span class="nx">width</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
                    <span class="nx">height</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
                <span class="p">};</span>
            <span class="p">};</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <h2>TextBodyEditor</h2>

<p>Handles HTML annotation lens for editing the bodyContent text.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Controller</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;TextBodyEditor&quot;</span><span class="p">);</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">TextBodyEditor</span><span class="p">.</span><span class="nx">initController</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">initController</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.TextBodyEditor&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>

        <span class="nx">that</span><span class="p">.</span><span class="nx">applyBindings</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">binding</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">editStart</span><span class="p">,</span>
            <span class="nx">editEnd</span><span class="p">,</span>
            <span class="nx">editUpdate</span><span class="p">,</span>
            <span class="nx">annoEl</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;annotation&#39;</span><span class="p">),</span>
            <span class="nx">bodyContent</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
            <span class="nx">allAnnos</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;annotations&#39;</span><span class="p">),</span>
            <span class="nx">textArea</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;textarea&#39;</span><span class="p">),</span>
            <span class="nx">editArea</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;editarea&#39;</span><span class="p">),</span>
            <span class="nx">editButton</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;editbutton&#39;</span><span class="p">),</span>
            <span class="nx">updateButton</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;updatebutton&#39;</span><span class="p">),</span>
            <span class="nx">deleteButton</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;deletebutton&#39;</span><span class="p">),</span>
            <span class="nx">bindingActive</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">prevMode</span><span class="p">;</span>

            <span class="nx">editStart</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">editArea</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">bodyContent</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
                <span class="nx">bindingActive</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onClick</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">itemId</span><span class="p">);</span>
            <span class="p">};</span>

            <span class="nx">editEnd</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">editArea</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">bodyContent</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
                <span class="nx">bindingActive</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

            <span class="p">};</span>

            <span class="nx">editUpdate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">textArea</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
                <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
                <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUpdate</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">itemId</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
                <span class="nx">editEnd</span><span class="p">();</span>
            <span class="p">};</span>

            <span class="nx">$</span><span class="p">(</span><span class="nx">annoEl</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;dblclick&#39;</span><span class="p">,</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">bindingActive</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">editEnd</span><span class="p">();</span>

                    <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">setCurrentMode</span><span class="p">(</span><span class="nx">prevMode</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">editStart</span><span class="p">();</span>
                    <span class="nx">prevMode</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">getCurrentMode</span><span class="p">();</span>
                    <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">setCurrentMode</span><span class="p">(</span><span class="s1">&#39;TextEdit&#39;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="nx">$</span><span class="p">(</span><span class="nx">annoEl</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>binding.events.onClick.fire(opts.itemId);</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">setActiveAnnotation</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">itemId</span><span class="p">);</span>
            <span class="p">});</span>

            <span class="nx">$</span><span class="p">(</span><span class="nx">updateButton</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUpdate</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">itemId</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">textArea</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
                <span class="nx">editEnd</span><span class="p">();</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">setCurrentMode</span><span class="p">(</span><span class="nx">prevMode</span><span class="p">);</span>
            <span class="p">});</span>

            <span class="nx">$</span><span class="p">(</span><span class="nx">deleteButton</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onDelete</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">itemId</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>remove DOM elements</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">$</span><span class="p">(</span><span class="nx">annoEl</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
            <span class="p">});</span>

            <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onActiveAnnotationChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="nx">bindingActive</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">editUpdate</span><span class="p">({</span>
                        <span class="nx">preventDefault</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
                    <span class="p">});</span>
                    <span class="nx">editEnd</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onCurrentModeChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">newMode</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">newMode</span> <span class="o">!==</span> <span class="s1">&#39;TextEdit&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">editEnd</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">};</span>
        <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <h2>CanvasClickController</h2>

<p>Listens for all clicks on the canvas and connects shapes with the Edit controller above</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Controller</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;CanvasClickController&quot;</span><span class="p">);</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">CanvasClickController</span><span class="p">.</span><span class="nx">initController</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">initController</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.CanvasClickController&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Create the object passed back to the Presentation</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">that</span><span class="p">.</span><span class="nx">applyBindings</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">binding</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ox</span><span class="p">,</span>
            <span class="nx">oy</span><span class="p">,</span>
            <span class="nx">extents</span><span class="p">,</span>
            <span class="nx">activeId</span><span class="p">,</span>
            <span class="nx">closeEnough</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">closeEnough</span><span class="p">,</span>
            <span class="nx">dx</span><span class="p">,</span>
            <span class="nx">dy</span><span class="p">,</span>
            <span class="nx">x</span><span class="p">,</span>
            <span class="nx">y</span><span class="p">,</span>
            <span class="nx">w</span><span class="p">,</span>
            <span class="nx">h</span><span class="p">,</span>
            <span class="nx">curRendering</span><span class="p">,</span>
            <span class="nx">renderings</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">paper</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">paper</span><span class="p">,</span>
            <span class="nx">offset</span><span class="p">,</span>
            <span class="nx">attachDragResize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">o</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">((</span><span class="nx">curRendering</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">curRendering</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">o</span> <span class="o">=</span> <span class="nx">renderings</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">o</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>de-activate rendering and all other listeners</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onClick</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>hide the editBox
editBoxController.deActivateEditBox();</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">curRendering</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
                    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="nx">curRendering</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span>

            <span class="p">},</span>
            <span class="nx">detachDragResize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">((</span><span class="nx">curRendering</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">curRendering</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="nx">renderings</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
            <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Using two html elements: container is for 
registering the offset of the screen (.section-canvas) and 
the svgEl is for registering mouse clicks on the svg element (svg)</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">drawShape</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">svgEl</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Sets mousedown, mouseup, mousemove to draw a 
shape on the canvas.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="kd">var</span> <span class="nx">mouseMode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                <span class="nx">topLeft</span> <span class="o">=</span> <span class="p">[],</span>
                <span class="nx">bottomRight</span> <span class="o">=</span> <span class="p">[],</span>
                <span class="nx">x</span><span class="p">,</span>
                <span class="nx">y</span><span class="p">,</span>
                <span class="nx">w</span><span class="p">,</span>
                <span class="nx">h</span><span class="p">,</span>
                <span class="nx">offset</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">offset</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>MouseMode cycles through three settings:
* 0: stasis
* 1: Mousedown and ready to drag
* 2: Mouse being dragged</p>

<p>remove all previous bindings</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">unbind</span><span class="p">();</span>
                
                <span class="nx">$</span><span class="p">(</span><span class="nx">svgEl</span><span class="p">).</span><span class="nx">mousedown</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">mouseMode</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
                    <span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
                    <span class="nx">topLeft</span> <span class="o">=</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">];</span>
                    <span class="nx">mouseMode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onShapeStart</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">topLeft</span><span class="p">);</span>
                <span class="p">});</span>

                <span class="nx">$</span><span class="p">(</span><span class="nx">svgEl</span><span class="p">).</span><span class="nx">mousemove</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">mouseMode</span> <span class="o">===</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">mouseMode</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
                    <span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
                    <span class="nx">bottomRight</span> <span class="o">=</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">];</span>
                    <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onShapeDrag</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">bottomRight</span><span class="p">);</span>
                <span class="p">});</span>

                <span class="nx">$</span><span class="p">(</span><span class="nx">svgEl</span><span class="p">).</span><span class="nx">mouseup</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">mouseMode</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nx">mouseMode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">bottomRight</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">bottomRight</span> <span class="o">=</span> <span class="p">[</span><span class="nx">x</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">y</span> <span class="o">+</span> <span class="mi">5</span><span class="p">];</span>
                    <span class="p">}</span>
                    <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onShapeDone</span><span class="p">.</span><span class="nx">fire</span><span class="p">({</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="nx">topLeft</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="nx">topLeft</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="nx">width</span><span class="o">:</span> <span class="p">(</span><span class="nx">bottomRight</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">topLeft</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="nx">height</span><span class="o">:</span> <span class="p">(</span><span class="nx">bottomRight</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">topLeft</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="p">});</span>
                <span class="p">});</span>
            <span class="p">},</span>
            <span class="nx">selectShape</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Sets mousedown events to select shapes, not to draw
them.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">unbind</span><span class="p">();</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span>
                <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>By default, nullifies all selections</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">setActiveAnnotation</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>
                    <span class="nx">activeId</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
                <span class="p">});</span>
                
            <span class="p">};</span>

            <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onActiveAnnotationChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">attachDragResize</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Change the mouse actions depending on what Mode the application is currently
in</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onCurrentModeChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">===</span> <span class="s1">&#39;Rectangle&#39;</span> <span class="o">||</span> <span class="nx">mode</span> <span class="o">===</span> <span class="s1">&#39;Ellipse&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">drawShape</span><span class="p">(</span><span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;svgwrapper&#39;</span><span class="p">),</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">));</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">===</span> <span class="s1">&#39;Select&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">selectShape</span><span class="p">(</span><span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">));</span>
                    
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)).</span><span class="nx">unbind</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Add to events</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">binding</span><span class="p">.</span><span class="nx">registerRendering</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newRendering</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">renderings</span><span class="p">[</span><span class="nx">newRendering</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">newRendering</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>add a click event to the SVG shape</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">newRendering</span><span class="p">.</span><span class="nx">shape</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">getCurrentMode</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;Select&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">activeId</span> <span class="o">=</span> <span class="nx">newRendering</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
                        <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">setActiveAnnotation</span><span class="p">(</span><span class="nx">newRendering</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">};</span>

            <span class="nx">binding</span><span class="p">.</span><span class="nx">removeRendering</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">oldRendering</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">delete</span> <span class="nx">renderings</span><span class="p">[</span><span class="nx">oldRendering</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
            <span class="p">};</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <h2>AnnotationCreationButton</h2>

<p>Controls the Annotation Creation Tools set by app.buttonFeature</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Controller</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;AnnotationCreationButton&#39;</span><span class="p">);</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">AnnotationCreationButton</span><span class="p">.</span><span class="nx">initController</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">initController</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.AnnotationCreationButton&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>

        <span class="nx">that</span><span class="p">.</span><span class="nx">applyBindings</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">binding</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">buttonEl</span><span class="p">,</span>
            <span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nx">onCurrentModeChangeHandle</span><span class="p">,</span>
            <span class="nx">id</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Mousedown: activate button - set as active mode</p>

<p>Mousedown #2: de-activate button - unset active mode</p>

<p>onCurrentModeChange: if != id passed, deactivate, else do nothing</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">buttonEl</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">);</span>

            <span class="nx">$</span><span class="p">(</span><span class="nx">buttonEl</span><span class="p">).</span><span class="nx">live</span><span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">active</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">active</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">setCurrentMode</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">action</span><span class="p">);</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">buttonEl</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">active</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">setCurrentMode</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">buttonEl</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="nx">onCurrentModeChangeHandle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">action</span> <span class="o">===</span> <span class="nx">options</span><span class="p">.</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">active</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">buttonEl</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">buttonEl</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onCurrentModeChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">onCurrentModeChangeHandle</span><span class="p">);</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <h2>sliderButton</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Controller</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;sliderButton&#39;</span><span class="p">);</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">sliderButton</span><span class="p">.</span><span class="nx">initController</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">initController</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.sliderButton&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>

        <span class="nx">that</span><span class="p">.</span><span class="nx">applyBindings</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">binding</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">sliderElement</span><span class="p">,</span>
            <span class="nx">displayElement</span><span class="p">,</span>
            <span class="nx">sliderStart</span><span class="p">,</span>
            <span class="nx">sliderMove</span><span class="p">,</span>
            <span class="nx">localTime</span><span class="p">,</span>
            <span class="nx">positionCheck</span><span class="p">;</span>
            <span class="nx">displayElement</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;timedisplay&#39;</span><span class="p">);</span>
            <span class="nx">positionCheck</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>if time is not equal to internal time, then 
reset the slider</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">localTime</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">localTime</span> <span class="o">=</span> <span class="nx">t</span><span class="p">;</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">sliderElement</span><span class="p">).</span><span class="nx">slider</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">localTime</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="nx">sliderStart</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">setCurrentTime</span><span class="p">(</span><span class="nx">ui</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">displayElement</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;TIME: &#39;</span> <span class="o">+</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
                <span class="nx">localTime</span> <span class="o">=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="nx">sliderMove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">ui</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">localTime</span> <span class="o">=</span> <span class="nx">e</span><span class="p">;</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">sliderElement</span><span class="p">).</span><span class="nx">slider</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">localTime</span> <span class="o">===</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">setCurrentTime</span><span class="p">(</span><span class="nx">ui</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">displayElement</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;TIME: &#39;</span> <span class="o">+</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
                <span class="nx">localTime</span> <span class="o">=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="p">};</span>
            <span class="nx">sliderElement</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s2">&quot;slider&quot;</span><span class="p">);</span>

            <span class="nx">$</span><span class="p">(</span><span class="nx">sliderElement</span><span class="p">).</span><span class="nx">slider</span><span class="p">({</span>
                <span class="nx">start</span><span class="o">:</span> <span class="nx">sliderStart</span><span class="p">,</span>
                <span class="nx">slide</span><span class="o">:</span> <span class="nx">sliderMove</span>
            <span class="p">});</span>


        <span class="p">};</span>

        <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <h2>timeControl</h2>

<p>Controller for manipulating the time sequence for an annotation.
Currently, just a text box for user to enter basic time data</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Controller</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;timeControl&#39;</span><span class="p">);</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">timeControl</span><span class="p">.</span><span class="nx">initController</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">initController</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.timeControl&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">currentId</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">applyBindings</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">binding</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">timestart</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;timestart&#39;</span><span class="p">),</span>
            <span class="nx">timeend</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;timeend&#39;</span><span class="p">),</span>
            <span class="nx">submit</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">),</span>
            <span class="nx">menudiv</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;menudiv&#39;</span><span class="p">),</span>
            <span class="nx">start_time</span><span class="p">,</span>
            <span class="nx">end_time</span><span class="p">;</span>

            <span class="nx">$</span><span class="p">(</span><span class="nx">menudiv</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>

            <span class="nx">$</span><span class="p">(</span><span class="nx">submit</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span>
            <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">start_time</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">timestart</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span> <span class="mi">10</span><span class="p">);</span>
                <span class="nx">end_time</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">timeend</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span> <span class="mi">10</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">binding</span><span class="p">.</span><span class="nx">currentId</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">start_time</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">end_time</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>update core data</p>             </td>             <td class="code">               <div class="highlight"><pre>                   
                    <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUpdate</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">binding</span><span class="p">.</span><span class="nx">currentId</span><span class="p">,</span> <span class="nx">start_time</span><span class="p">,</span> <span class="nx">end_time</span><span class="p">);</span>
                    
                    <span class="nx">$</span><span class="p">(</span><span class="nx">menudiv</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onActiveAnnotationChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">menudiv</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">timestart</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">timeend</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
                    <span class="nx">binding</span><span class="p">.</span><span class="nx">currentId</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">menudiv</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <h2>WindowResize</h2>

<p>Emits an onResize event when the browser window is resized.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Controller</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;WindowResize&#39;</span><span class="p">);</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">WindowResize</span><span class="p">.</span><span class="nx">initController</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">initController</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.WindowResize&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>
        
        <span class="nx">that</span><span class="p">.</span><span class="nx">applyBindings</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">binding</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">locate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
            <span class="nx">w</span><span class="p">.</span><span class="nx">resize</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onResize</span><span class="p">.</span><span class="nx">fire</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">};</span>
        
        <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nx">MITHGrid</span><span class="p">,</span> <span class="nx">OAC</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <h1>Presentations</h1>

<p>TODO: rename file to presentation.js</p>

<p>Presentations for canvas.js
@author Grant Dickie</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">MITHGrid</span><span class="p">,</span> <span class="nx">OAC</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <h2>AnnotationList</h2>

<p>Presentation that extends SimpleText in order to add new 
functionality for Annotation HTML lens</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Presentation</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;AnnotationList&quot;</span><span class="p">);</span>
    <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Presentation</span><span class="p">.</span><span class="nx">AnnotationList</span><span class="p">.</span><span class="nx">initPresentation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Presentation</span><span class="p">.</span><span class="nx">initPresentation</span><span class="p">(</span><span class="s2">&quot;MITHGrid.Presentation.AnnotationList&quot;</span><span class="p">,</span> <span class="nx">container</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <h2>RaphaelCanvas</h2>

<p>Presentation for the Canvas area - area that the Raphael canvas is drawn on</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Presentation</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;RaphaelCanvas&quot;</span><span class="p">);</span>
    <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Presentation</span><span class="p">.</span><span class="nx">RaphaelCanvas</span><span class="p">.</span><span class="nx">initPresentation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Presentation</span><span class="p">.</span><span class="nx">initPresentation</span><span class="p">(</span><span class="s2">&quot;MITHGrid.Presentation.RaphaelCanvas&quot;</span><span class="p">,</span> <span class="nx">container</span><span class="p">,</span> <span class="nx">options</span><span class="p">),</span>
        <span class="nx">id</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span>
        <span class="nx">h</span><span class="p">,</span>
        <span class="nx">w</span><span class="p">,</span>
        <span class="nx">x</span><span class="p">,</span>
        <span class="nx">y</span><span class="p">,</span>
        <span class="nx">canvasController</span><span class="p">,</span>
        <span class="nx">keyBoardController</span><span class="p">,</span>
        <span class="nx">editBoxController</span><span class="p">,</span>
        <span class="nx">superRender</span><span class="p">,</span>
        <span class="nx">canvasBinding</span><span class="p">,</span>
        <span class="nx">keyboardBinding</span><span class="p">,</span>
        <span class="nx">shapeCreateController</span><span class="p">,</span>
        <span class="nx">shapeCreateBinding</span><span class="p">,</span>
        <span class="nx">windowResizeController</span><span class="p">,</span>
        <span class="nx">windowResizeBinding</span><span class="p">,</span>
        <span class="nx">changeCanvasCoordinates</span><span class="p">,</span>
        <span class="nx">e</span><span class="p">,</span>
        <span class="nx">superEventFocusChange</span><span class="p">,</span>
        <span class="nx">editBoundingBoxBinding</span><span class="p">,</span>
        <span class="nx">eventCurrentTimeChange</span><span class="p">,</span>
        <span class="nx">searchAnnos</span><span class="p">,</span>
        <span class="nx">allAnnosModel</span><span class="p">,</span>
        <span class="nx">initCanvas</span><span class="p">,</span>
        <span class="nx">cachedRendering</span><span class="p">,</span> <span class="nx">xy</span><span class="p">,</span> <span class="nx">wh</span><span class="p">;</span>

        <span class="nx">options</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>
        


        <span class="nx">canvasController</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">controllers</span><span class="p">.</span><span class="nx">canvas</span><span class="p">;</span>
        <span class="nx">keyBoardController</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">controllers</span><span class="p">.</span><span class="nx">keyboard</span><span class="p">;</span>
        <span class="nx">editBoxController</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">controllers</span><span class="p">.</span><span class="nx">shapeEditBox</span><span class="p">;</span>
        <span class="nx">shapeCreateController</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">controllers</span><span class="p">.</span><span class="nx">shapeCreateBox</span><span class="p">;</span>
        <span class="nx">windowResizeController</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">controllers</span><span class="p">.</span><span class="nx">windowResize</span><span class="p">;</span>
        
        <span class="nx">x</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span>
        <span class="nx">y</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">);</span>

        
        <span class="nx">w</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">width</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>measure the div space and make the canvas
to fit</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">h</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">height</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>FIXME: We need to change this. If we have multiple videos on a page, this will break.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">keyboardBinding</span> <span class="o">=</span> <span class="nx">keyBoardController</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span> <span class="p">{});</span>

        <span class="nx">that</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">,</span> <span class="nx">keyboardBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>init RaphaelJS canvas
Parameters for Raphael:
* @x: value for top left corner
* @y: value for top left corner
* @w: Integer value for width of the SVG canvas
* @h: Integer value for height of the SVG canvas
Create canvas at xy and width height</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">that</span><span class="p">.</span><span class="nx">canvas</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Raphael</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">),</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">);</span>
    </pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>attach binding
FIXME: We need to change this. If we have multiple videos on a page, this will break.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">canvasBinding</span> <span class="o">=</span> <span class="nx">canvasController</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span> <span class="p">{</span>
            <span class="nx">closeEnough</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="nx">paper</span><span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">canvas</span>
        <span class="p">});</span>

        <span class="nx">editBoundingBoxBinding</span> <span class="o">=</span> <span class="nx">editBoxController</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">),</span> <span class="p">{</span>
            <span class="nx">paper</span><span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">canvas</span>
        <span class="p">});</span>

        <span class="nx">shapeCreateBinding</span> <span class="o">=</span> <span class="nx">shapeCreateController</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">),</span> <span class="p">{</span>
            <span class="nx">paper</span><span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">canvas</span>
        <span class="p">});</span>
        </pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>FIXME: We need to change this. If we have multiple videos on a page, this will break.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">windowResizeBinding</span> <span class="o">=</span> <span class="nx">windowResizeController</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span>
    
        <span class="nx">windowResizeBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onResize</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">containerEl</span><span class="p">,</span> <span class="nx">canvasEl</span><span class="p">,</span> <span class="nx">htmlWrapper</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>the following elements should be parts of this presentation</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">canvasEl</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">);</span>
            <span class="nx">containerEl</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#myplayer&#39;</span><span class="p">);</span>
            <span class="nx">htmlWrapper</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.section-canvas&#39;</span><span class="p">);</span>
            <span class="nx">x</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">containerEl</span><span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">left</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
            <span class="nx">y</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">containerEl</span><span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
            <span class="nx">w</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">containerEl</span><span class="p">).</span><span class="nx">width</span><span class="p">(),</span> <span class="mi">10</span><span class="p">);</span>
            <span class="nx">h</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">containerEl</span><span class="p">).</span><span class="nx">height</span><span class="p">(),</span> <span class="mi">10</span><span class="p">);</span>

            <span class="nx">$</span><span class="p">(</span><span class="nx">canvasEl</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
                <span class="nx">left</span><span class="o">:</span> <span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">,</span>
                <span class="nx">top</span><span class="o">:</span> <span class="nx">y</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">,</span>
                <span class="nx">width</span><span class="o">:</span> <span class="nx">w</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">,</span>
                <span class="nx">height</span><span class="o">:</span> <span class="nx">h</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span>
            <span class="p">});</span>
            
            <span class="nx">$</span><span class="p">(</span><span class="nx">htmlWrapper</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
                <span class="nx">left</span><span class="o">:</span> <span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">,</span>
                <span class="nx">top</span><span class="o">:</span> <span class="nx">y</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">,</span>
                <span class="nx">width</span><span class="o">:</span> <span class="nx">w</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">,</span>
                <span class="nx">height</span><span class="o">:</span> <span class="nx">h</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span>
            <span class="p">});</span>
        <span class="p">});</span>
        </pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Registering canvas special events for start, drag, stop</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">canvasBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onShapeStart</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">coords</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">shapeCreateBinding</span><span class="p">.</span><span class="nx">createGuide</span><span class="p">(</span><span class="nx">coords</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="nx">canvasBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onShapeDrag</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">coords</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">shapeCreateBinding</span><span class="p">.</span><span class="nx">resizeGuide</span><span class="p">(</span><span class="nx">coords</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="nx">canvasBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onShapeDone</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">coords</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Adjust x,y in order to fit data store 
model</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">shape</span> <span class="o">=</span> <span class="nx">shapeCreateBinding</span><span class="p">.</span><span class="nx">completeShape</span><span class="p">(</span><span class="nx">coords</span><span class="p">);</span>
            <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">insertShape</span><span class="p">(</span><span class="nx">shape</span><span class="p">);</span>
        <span class="p">});</span>
        
        </pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Called whenever a player is set by the Application. 
Assumes that said player object has getcoordinates() and 
getsize() as valid methods that return arrays.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">changeCanvasCoordinates</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">args</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                </pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>player passes args of x,y and width, height</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">xy</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">getcoordinates</span><span class="p">();</span>
                <span class="nx">wh</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">getsize</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>move container and change size</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
                    <span class="nx">left</span><span class="o">:</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">),</span>
                    <span class="nx">top</span><span class="o">:</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">),</span>
                    <span class="nx">width</span><span class="o">:</span> <span class="nx">wh</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="nx">height</span><span class="o">:</span> <span class="nx">wh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Move canvas SVG to this location</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
                    <span class="nx">left</span><span class="o">:</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">),</span>
                    <span class="nx">top</span><span class="o">:</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">),</span>
                    <span class="nx">width</span><span class="o">:</span> <span class="nx">wh</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="nx">height</span><span class="o">:</span> <span class="nx">wh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">});</span>

            <span class="p">}</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Called when the time change event is fired. Makes sure
that the present annotations are queued and have the correct
opacity (Fades as it comes into play and fades as it goes out
of play)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">eventCurrentTimeChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">npt</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">visitRenderings</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">rendering</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">rendering</span><span class="p">.</span><span class="nx">eventCurrentTimeChange</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">rendering</span><span class="p">.</span><span class="nx">eventCurrentTimeChange</span><span class="p">(</span><span class="nx">npt</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">};</span>

        <span class="nx">eventTimeEasementChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">te</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">visitRenderings</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">rendering</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">rendering</span><span class="p">.</span><span class="nx">eventTimeEasementChange</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">rendering</span><span class="p">.</span><span class="nx">eventTimeEasementChange</span><span class="p">(</span><span class="nx">te</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">};</span>

        <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onCurrentTimeChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">eventCurrentTimeChange</span><span class="p">);</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onPlayerChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">changeCanvasCoordinates</span><span class="p">);</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">dataStore</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onModelChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">editBoundingBoxBinding</span><span class="p">.</span><span class="nx">detachRendering</span><span class="p">();</span>
        <span class="p">});</span>
        
        <span class="nx">superRender</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">render</span><span class="p">;</span>
        
        <span class="nx">that</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">rendering</span> <span class="o">=</span> <span class="nx">superRender</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">i</span><span class="p">),</span>
            <span class="nx">tempStore</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">rendering</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>

                <span class="nx">tempStore</span> <span class="o">=</span> <span class="nx">m</span><span class="p">;</span>
                <span class="k">while</span> <span class="p">(</span><span class="nx">tempStore</span><span class="p">.</span><span class="nx">dataStore</span><span class="p">)</span> <span class="p">{</span>

                    <span class="nx">tempStore</span> <span class="o">=</span> <span class="nx">tempStore</span><span class="p">.</span><span class="nx">dataStore</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">allAnnosModel</span> <span class="o">=</span> <span class="nx">tempStore</span><span class="p">;</span>
                <span class="nx">searchAnnos</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">dataView</span><span class="p">.</span><span class="nx">prepare</span><span class="p">([</span><span class="s1">&#39;!type&#39;</span><span class="p">]);</span>
                
                <span class="nx">canvasBinding</span><span class="p">.</span><span class="nx">registerRendering</span><span class="p">(</span><span class="nx">rendering</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">rendering</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="nx">that</span><span class="p">.</span><span class="nx">renderItems</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

        <span class="p">};</span>

        <span class="nx">superEventFocusChange</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">eventFocusChange</span><span class="p">;</span>

        <span class="nx">that</span><span class="p">.</span><span class="nx">eventFocusChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">getCurrentMode</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;Select&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">superEventFocusChange</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
                <span class="nx">editBoundingBoxBinding</span><span class="p">.</span><span class="nx">attachRendering</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">renderingFor</span><span class="p">(</span><span class="nx">id</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>console.log(that);</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nx">MITHGrid</span><span class="p">,</span> <span class="nx">OAC</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>End of Presentation constructors</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <h1>Annotation Application</h1>

<p>TODO: rename file to application.js</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">MITHGrid</span><span class="p">,</span> <span class="nx">OAC</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">canvasId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <h2>StreamingVideo.initApp</h2>

<p>Parameters:</p>

<ul>
<li>container - the DOM container in which the application should place its content</li>
<li>options - an object holding configuration information</li>
</ul>

<p>Returns:</p>

<p>The configured OAC streaming video annotation client object.</p>

<p>Options:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">initApp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">renderListItem</span><span class="p">,</span>
        <span class="nx">app</span><span class="p">,</span>
        <span class="nx">svgLens</span><span class="p">,</span>
        <span class="nx">textLens</span><span class="p">,</span>
        <span class="nx">fade</span><span class="p">,</span>
        <span class="nx">shapeTypes</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">shapeAnnotationId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">myCanvasId</span> <span class="o">=</span> <span class="s1">&#39;OAC-Client-StreamingVideo-SVG-Canvas-&#39;</span> <span class="o">+</span> <span class="nx">canvasId</span><span class="p">,</span>
        <span class="nx">xy</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">wh</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>Generating the canvasId allows us to have multiple instances of the application on a page and still
have a unique ID as expected by the RaphaÃ«l library.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">canvasId</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="nx">app</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">initApp</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo&quot;</span><span class="p">,</span> <span class="nx">container</span><span class="p">,</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span>
        <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>We create a general template that holds all of the different DOM elements we need:</p>

<ul>
<li>the SVG view that will overlay the play surface (myCanvasId is the DOM id)</li>
<li>the time selection input area (.timeselect)</li>
<li>the controls (.section-controls)</li>
<li>the annotations (.section-annotations)</li>
</ul>

<p>TODO: Split out display of modes into a separate issue... let this application focus on
     the display of annotations and targets instead of the chrome.
     We'll put together a demo page that does have all of the parts working together.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">viewSetup</span><span class="o">:</span>
                <span class="s1">&#39;&lt;div id=&quot;&#39;</span> <span class="o">+</span> <span class="nx">myCanvasId</span> <span class="o">+</span> <span class="s1">&#39;&quot; class=&quot;section-canvas&quot;&gt;&lt;/div&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;div class=&quot;mithgrid-bottomarea&quot;&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;div class=&quot;timeselect&quot;&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;p&gt;Enter start time:&lt;/p&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;input id=&quot;timestart&quot; type=&quot;text&quot; /&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;p&gt;Enter end time:&lt;/p&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;input id=&quot;timeend&quot; type=&quot;text&quot; /&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;div id=&quot;submittime&quot; class=&quot;button&quot;&gt;Confirm time settings&lt;/div&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;/div&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;div id=&quot;sidebar&#39;</span> <span class="o">+</span> <span class="nx">myCanvasId</span> <span class="o">+</span> <span class="s1">&#39;&quot; class=&quot;section-controls&quot;&gt;&lt;/div&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;div class=&quot;section-annotations&quot;&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;div class=&quot;header&quot;&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;Annotations&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;/div&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;/div&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>We make the isActive() function available to the keyboard controller to let it know if
the keyboard should be considered active.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">controllers</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">keyboard</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">isActive</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">app</span><span class="p">.</span><span class="nx">getCurrentMode</span><span class="p">()</span> <span class="o">!==</span> <span class="s1">&#39;Editing&#39;</span><span class="p">;</span> <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>We connect the SVG overlay and annotation sections of the DOM with their respective
presentations.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">presentations</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">raphsvg</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">container</span><span class="o">:</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">myCanvasId</span><span class="p">,</span>
                    <span class="nx">lenses</span><span class="o">:</span> <span class="p">{</span> <span class="p">},</span>
                    <span class="nx">lensKey</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;.shapeType&#39;</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="nx">annoItem</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">container</span><span class="o">:</span> <span class="s1">&#39;.section-annotations&#39;</span><span class="p">,</span>
                    <span class="nx">lenses</span><span class="o">:</span> <span class="p">{</span> <span class="p">},</span>
                    <span class="nx">lensKey</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;.bodyType&#39;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">options</span><span class="p">)</span>
        <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <h3>#initShapeLens</h3>

<p>Initializes a basic shape lens. The default methods expect the RaphaÃ«l SVG shape object to
be held in the .shape property.</p>

<p>Parameters:</p>

<ul>
<li>container - the container holding the lens content</li>
<li>view - the presentation managing the collection of renderings</li>
<li>model - the data store or data view holding information about the item to be rendered</li>
<li>itemId - the item ID of the item to be rendered</li>
</ul>

<p>Returns:</p>

<p>The basic lens object with the following methods defined:</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">app</span><span class="p">.</span><span class="nx">initShapeLens</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">view</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">itemId</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">id</span><span class="o">:</span> <span class="nx">itemId</span>
            <span class="p">};</span>
            </pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <h4>#eventFocus</h4>

<p>Called when this rendering receives the selection focus. The default implementation brings the rendering
to the front and makes it opaque.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">eventFocus</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">shape</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                    <span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span>
                <span class="p">}).</span><span class="nx">toFront</span><span class="p">();</span>
                <span class="nx">view</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onDelete</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">eventDelete</span><span class="p">);</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <h4>#eventUnfocus</h4>

<p>Called when this rendering loses the selection focus. The default implementation pushes the rendering
to the back and makes it semi-transparent.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">eventUnfocus</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">shape</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                    <span class="nx">opacity</span><span class="o">:</span> <span class="mf">0.5</span>
                <span class="p">}).</span><span class="nx">toBack</span><span class="p">();</span>
                <span class="nx">view</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onDelete</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">eventDelete</span><span class="p">);</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <h4>#eventDelete</h4>

<p>Called when the data item represented by this rendering is to be deleted. The default implementation
passes the deletion request to the data store with the item ID represented by the rendering.</p>

<p>The data item is removed if and only if the id passed in matches the id of the rendered item.</p>

<p>Parameters:</p>

<ul>
<li>id - the item ID of the item to be deleted</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">eventDelete</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">itemId</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">model</span><span class="p">.</span><span class="nx">removeItems</span><span class="p">([</span><span class="nx">itemId</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <h4>#eventResize</h4>

<p>Called when the bounding box of the rendering changes size.</p>

<p>The item is resized if and only if the id passed in matches the id of the rendered item.</p>

<p>Parameters:</p>

<ul>
<li>id - the item ID of the item to be resized</li>
<li>pos - object containing the .width and .height properties</li>
</ul>

<p>Returns: Nothing.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">eventResize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">pos</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">itemId</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">model</span><span class="p">.</span><span class="nx">updateItems</span><span class="p">([{</span>
                        <span class="nx">id</span><span class="o">:</span> <span class="nx">itemId</span><span class="p">,</span>
                        <span class="nx">w</span><span class="o">:</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
                        <span class="nx">h</span><span class="o">:</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">height</span>
                    <span class="p">}]);</span>
                <span class="p">}</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <h4>#eventMove</h4>

<p>Called when the bounding box of the rendering is moved.</p>

<p>The item is moved if and only if the id passed in matches the id of the rendered item.</p>

<p>Parameters:</p>

<ul>
<li>id - the item ID of the item to be moved</li>
<li>pos - object containing the .x and .y properties</li>
</ul>

<p>Returns: Nothing.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">eventMove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">pos</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">itemId</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">model</span><span class="p">.</span><span class="nx">updateItems</span><span class="p">([{</span>
                        <span class="nx">id</span><span class="o">:</span> <span class="nx">itemId</span><span class="p">,</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span>
                    <span class="p">}]);</span>
                <span class="p">}</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <h4>#remove</h4>

<p>Called to remove the rendering from the presentation.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">shape</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
            <span class="p">};</span>

            <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <h3>#initTextLens</h3>

<p>Initializes a basic text lens.</p>

<p>Parameters:</p>

<ul>
<li>container - the container holding the lens content</li>
<li>view - the presentation managing the collection of renderings</li>
<li>model - the data store or data view holding information abut the item to be rendered</li>
<li>itemId - the item ID of the item to be rendered</li>
</ul>

<p>Returns:</p>

<p>The basic lens object.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">app</span><span class="p">.</span><span class="nx">initTextLens</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">view</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">itemId</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">item</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">itemId</span><span class="p">),</span>
            <span class="nx">itemEl</span><span class="p">,</span>
            <span class="nx">annoEvents</span><span class="p">,</span>
            <span class="nx">bodyContentTextArea</span><span class="p">,</span>
            <span class="nx">bodyContent</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>We put together a template representing the text annotations associated with any shape.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">itemEl</span> <span class="o">=</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;anno_item&quot;&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;p class=&quot;bodyContentInstructions&quot;&gt;Double click here to open edit window.&lt;/p&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;div class=&quot;editArea&quot;&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;textarea class=&quot;bodyContentTextArea&quot;&gt;&lt;/textarea&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;div id=&quot;editUpdate&quot; class=&quot;button update&quot;&gt;Update&lt;/div&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;div id=&quot;editDelete&quot; class=&quot;button delete&quot;&gt;Delete&lt;/div&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;/div&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;div class=&quot;body&quot;&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;p class=&quot;bodyContent&quot;&gt;&lt;/p&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;/div&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>We capture the parts of the annotation presentation for use later.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">bodyContentTextArea</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">itemEl</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.bodyContentTextArea&quot;</span><span class="p">);</span>
            <span class="nx">bodyContent</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">itemEl</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.bodyContent&quot;</span><span class="p">);</span>

            <span class="nx">$</span><span class="p">(</span><span class="nx">bodyContentTextArea</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">bodyContent</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="nx">$</span><span class="p">(</span><span class="nx">bodyContent</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">bodyContent</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>We attach the rendering to the container and hide the edit area.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">itemEl</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="nx">itemEl</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.editArea&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>We then construct the following methods:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <h4>#eventFocus</h4>

<p>Called when this rendering receives the selection focus. The default implementation adds the
.selected CSS class.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">eventFocus</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">itemEl</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">);</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <h4>#eventUnfocus</h4>

<p>Called when this rendering loses the selection focus. The default implementation removes the
.selected CSS class.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">eventUnfocus</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">itemEl</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">);</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <h4>#eventUpdate</h4>

<p>Called when the text annotation body is updated. This will update the data store with the new body.</p>

<p>The rendering is update if and only if the id passed in matches the id of the rendered item.</p>

<p>Parameters:</p>

<ul>
<li>id - the item ID of the item to be updated</li>
<li>data - the object holding the current data associated with the item ID</li>
</ul>

<p>Returns: Nothing.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">eventUpdate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">itemId</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">model</span><span class="p">.</span><span class="nx">updateItems</span><span class="p">([{</span>
                        <span class="nx">id</span><span class="o">:</span> <span class="nx">itemId</span><span class="p">,</span>
                        <span class="nx">bodyContent</span><span class="o">:</span> <span class="nx">data</span>
                    <span class="p">}]);</span>
                <span class="p">}</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <h4>#eventDelete</h4>

<p>Called when the data item represented by this rendering is to be deleted. The default implementation
passes the deletion request to the data store with the item ID represented by the rendering.</p>

<p>The data item is removed if and only if the id passed in matches the id of the rendered item.</p>

<p>Parameters:</p>

<ul>
<li>id - the item ID of the item to be deleted</li>
</ul>

<p>Returns: Nothing.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">eventDelete</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">itemId</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">model</span><span class="p">.</span><span class="nx">removeItems</span><span class="p">([</span><span class="nx">itemId</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <h4>#update</h4>

<p>Called when the underlying data represented by the rendering changes. The rendering is updated to
reflect the item data.</p>

<p>The rendering is update if and only if the id passed in matches the id of the rendered item.</p>

<p>Parameters:</p>

<ul>
<li>data - the object holding the current data associated with the item ID</li>
</ul>

<p>Returns: Nothing.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">itemEl</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.bodyContent&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">bodyContent</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">itemEl</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.bodyContentTextArea&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">bodyContent</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <h4>#remove</h4>

<p>Called to remove the rendering from the presentation.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">itemEl</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <h4>UI events</h4>

<p>We attach a controller to highlight the
HTML when the corresponding shape is selected.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">annoEvents</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">annoActive</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">itemEl</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">model</span><span class="o">:</span> <span class="nx">model</span><span class="p">,</span>
                <span class="nx">itemId</span><span class="o">:</span> <span class="nx">itemId</span>
            <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>We hook up the events generated by the controller to events on the application or
rendering, as appropriate.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">annoEvents</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onClick</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">setActiveAnnotation</span><span class="p">);</span>
            <span class="nx">annoEvents</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onDelete</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">eventDelete</span><span class="p">);</span>
            <span class="nx">annoEvents</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUpdate</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">eventUpdate</span><span class="p">);</span>


            <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <h3>app.buttonFeature</h3>

<p>Creates an HTML div that acts as a button</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">app</span><span class="p">.</span><span class="nx">buttonFeature</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">area</span><span class="p">,</span> <span class="nx">grouping</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
            </pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>Check to make sure button isn't already present
FIXME: make sure the id is unique in the page since we can have multiple instances of the
annotation client (one per video)</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">action</span><span class="p">).</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// Abort</span>
            <span class="p">}</span>

            <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="nx">item</span><span class="p">,</span>
            <span class="nx">buttons</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.button&quot;</span><span class="p">),</span>
            <span class="nx">groupEl</span><span class="p">,</span>
            <span class="nx">container</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#sidebar&quot;</span> <span class="o">+</span> <span class="nx">myCanvasId</span><span class="p">),</span>
            <span class="nx">buttonBinding</span><span class="p">,</span>
            <span class="nx">insertButton</span><span class="p">,</span>
            <span class="nx">insertSlider</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">area</span> <span class="o">===</span> <span class="s1">&#39;buttongrouping&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="cm">/*</span>
<span class="cm">                Set the group element where this button should go in. If no group </span>
<span class="cm">                element is yet created, create that group element with name *grouping*</span>
<span class="cm">                */</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">grouping</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;div id=&quot;&#39;</span> <span class="o">+</span> <span class="nx">grouping</span> <span class="o">+</span> <span class="s1">&#39;&quot; class=&quot;buttongrouping&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nx">groupEl</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">grouping</span><span class="p">);</span>

                <span class="cm">/*</span>
<span class="cm">                generate HTML for button, then attach the callback. action</span>
<span class="cm">                refers to ID and also the title of the button</span>
<span class="cm">                */</span>
                <span class="nx">item</span> <span class="o">=</span> <span class="s1">&#39;&lt;div id=&quot;&#39;</span> <span class="o">+</span> <span class="nx">action</span> <span class="o">+</span> <span class="s1">&#39;&quot; class=&quot;button&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">action</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>

                <span class="nx">$</span><span class="p">(</span><span class="nx">groupEl</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>

                <span class="nx">that</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">action</span><span class="p">);</span>

                <span class="nx">buttonBinding</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">buttonActive</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">action</span><span class="o">:</span> <span class="nx">action</span>
                <span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">area</span> <span class="o">===</span> <span class="s1">&#39;slidergrouping&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">grouping</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;div id=&quot;&#39;</span> <span class="o">+</span> <span class="nx">grouping</span> <span class="o">+</span> <span class="s1">&#39;&quot; class=&quot;slidergrouping&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nx">groupEl</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">grouping</span><span class="p">);</span>

                <span class="cm">/*</span>
<span class="cm">                HTML for slider button</span>
<span class="cm">                */</span>
                <span class="nx">item</span> <span class="o">=</span> <span class="s1">&#39;&lt;div id=&quot;&#39;</span> <span class="o">+</span> <span class="nx">action</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&lt;div class=&quot;header&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">action</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;div id=&quot;slider&quot;&gt;&lt;/div&gt;&lt;div class=&quot;timedisplay&quot;&gt;&lt;/div&gt;&lt;/div&gt;&#39;</span><span class="p">;</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">groupEl</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">action</span><span class="p">);</span>

                <span class="nx">buttonBinding</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">slider</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">action</span><span class="o">:</span> <span class="nx">action</span>
                <span class="p">});</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <h3>#addShape</h3>

<p>Adds a shape lens to the SVG overlay presentation.</p>

<p>Parameters:</p>

<ul>
<li>key - the internal shape name</li>
<li>svgShape - the lens rendering function for rendering the shape on the SVG overlay</li>
</ul>

<p>Returns: Nothing.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">app</span><span class="p">.</span><span class="nx">addShape</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">svgShape</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">presentation</span><span class="p">.</span><span class="nx">raphsvg</span><span class="p">.</span><span class="nx">addLens</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">svgShape</span><span class="p">);</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <h3>#addBody</h3>

<p>Adds an annotation body lens to the annotation presentation</p>

<p>Parameters:</p>

<ul>
<li>key - the internal annotation body type</li>
<li>textLens - the lens rendering function for rendering the annotation body in the annotation presentation</li>
</ul>

<p>Returns: Nothing.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">app</span><span class="p">.</span><span class="nx">addBody</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">textLens</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">presentation</span><span class="p">.</span><span class="nx">annoItem</span><span class="p">.</span><span class="nx">addLens</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">textLens</span><span class="p">);</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <h3>#addShapeType</h3>

<p>Adds a shape type. This includes a lens, a button to activate the shape mode, and
a callback function for creating an item in the data store.</p>

<p>Parameters:</p>

<ul>
<li>type - the internal shape name</li>
<li>args - an object containing the following items:
<ul><li>calc - the callback function for inserting the new shape into the data store</li>
<li>lens - the lens rendering function for rendering the shape on the SVG overlay</li></ul></li>
</ul>

<p>Returns: Nothing.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">app</span><span class="p">.</span><span class="nx">addShapeType</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">button</span><span class="p">,</span>
            <span class="nx">calcF</span><span class="p">,</span>
            <span class="nx">lensF</span><span class="p">;</span>

            <span class="nx">calcF</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">calc</span><span class="p">;</span>
            <span class="nx">lensF</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">lens</span><span class="p">;</span>
            <span class="nx">button</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">buttonFeature</span><span class="p">(</span><span class="s1">&#39;Shapes&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="p">);</span>

            <span class="nx">shapeTypes</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">calc</span><span class="o">:</span> <span class="nx">calcF</span>
            <span class="p">};</span>

            <span class="nx">app</span><span class="p">.</span><span class="nx">addShape</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">lensF</span><span class="p">);</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <h3>#insertShape</h3>

<p>Inserts a new annotation into the data store using the passed coordinates. An empty text annotation body
is added. The application CurrentMode variable determines the shape. The time span is 5 seconds on either side
of the CurrentTime variable.</p>

<p>Parameters:</p>

<ul>
<li>coords - the coordinates of the center of the shape in the .x, .y, .width, and .height properties.</li>
</ul>

<p>Returns: Nothing.</p>             </td>             <td class="code">               <div class="highlight"><pre>        </pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>FIXME: We should ensure that we don't have clashing IDs. We need to use UUIDs when possible.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">app</span><span class="p">.</span><span class="nx">insertShape</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">coords</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">shapeItem</span><span class="p">,</span>
            <span class="nx">ntp_start</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">getCurrentTime</span><span class="p">())</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span>
            <span class="nx">ntp_end</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">getCurrentTime</span><span class="p">())</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span>
            <span class="nx">curMode</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">getCurrentMode</span><span class="p">(),</span>
            <span class="nx">shape</span><span class="p">;</span>

            <span class="nx">shape</span> <span class="o">=</span> <span class="nx">shapeTypes</span><span class="p">[</span><span class="nx">curMode</span><span class="p">].</span><span class="nx">calc</span><span class="p">(</span><span class="nx">coords</span><span class="p">);</span>
            <span class="nx">shapeAnnotationId</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

            <span class="nx">shapeItem</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">id</span><span class="o">:</span> <span class="s2">&quot;anno&quot;</span> <span class="o">+</span> <span class="nx">shapeAnnotationId</span><span class="p">,</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;Annotation&quot;</span><span class="p">,</span>
                <span class="nx">bodyType</span><span class="o">:</span> <span class="s2">&quot;Text&quot;</span><span class="p">,</span>
                <span class="nx">bodyContent</span><span class="o">:</span> <span class="s2">&quot;This is an annotation for &quot;</span> <span class="o">+</span> <span class="nx">curMode</span><span class="p">,</span>
                <span class="nx">shapeType</span><span class="o">:</span> <span class="nx">curMode</span><span class="p">,</span>
                <span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nx">ntp_start</span><span class="o">:</span> <span class="nx">ntp_start</span><span class="p">,</span>
                <span class="nx">ntp_end</span><span class="o">:</span> <span class="nx">ntp_end</span>
            <span class="p">};</span>

            <span class="nx">app</span><span class="p">.</span><span class="nx">dataStore</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">loadItems</span><span class="p">([</span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">shapeItem</span><span class="p">,</span> <span class="nx">shape</span><span class="p">)]);</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <h3>#exportShapes</h3>

<p>Exports all annotation data as JSON. All SVG data is converted to generic units.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">app</span><span class="p">.</span><span class="nx">exportShapes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">canvasWidth</span><span class="p">,</span>
            <span class="nx">canvasHeight</span><span class="p">;</span>

            <span class="nx">canvasWidth</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">myCanvasId</span><span class="p">).</span><span class="nx">width</span><span class="p">();</span>
            <span class="nx">canvasHeight</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">myCanvasId</span><span class="p">).</span><span class="nx">height</span><span class="p">();</span>

            <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">([]);</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <h2>Application Configuration</h2>

<p>The rest of this prepares the annotation application once it's in the up-and-running process.</p>

<p>We wrap all of this in the app.ready() call so we will have all of the events, presentations,
data stores, etc., instantiated for us.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">app</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>We want the SVG overlay and the annotation body presentation to react to changes in
the selection focus.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">app</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onActiveAnnotationChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">presentation</span><span class="p">.</span><span class="nx">raphsvg</span><span class="p">.</span><span class="nx">eventFocusChange</span><span class="p">);</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onActiveAnnotationChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">presentation</span><span class="p">.</span><span class="nx">annoItem</span><span class="p">.</span><span class="nx">eventFocusChange</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>We always want the current annotation list to include anything that covers a time within five seconds
of the current time.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">app</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onCurrentTimeChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">app</span><span class="p">.</span><span class="nx">dataView</span><span class="p">.</span><span class="nx">currentAnnotations</span><span class="p">.</span><span class="nx">setKeyRange</span><span class="p">(</span><span class="nx">t</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">t</span> <span class="o">+</span> <span class="mi">5</span><span class="p">);</span>
            <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <p>We currently have a Player variable that handles the current player object. This may change since
we intend for the annotation client to be bound to a particular video stream on the page.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">app</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onPlayerChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">playerobject</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">app</span><span class="p">.</span><span class="nx">setCurrentTime</span><span class="p">(</span><span class="nx">playerobject</span><span class="p">.</span><span class="nx">getPlayhead</span><span class="p">());</span>
                <span class="nx">playerobject</span><span class="p">.</span><span class="nx">onPlayheadUpdate</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">app</span><span class="p">.</span><span class="nx">setCurrentTime</span><span class="p">((</span><span class="nx">app</span><span class="p">.</span><span class="nx">getCurrentTime</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
                <span class="p">});</span>
                <span class="nx">app</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onCurrentModeChange</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">nmode</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">nmode</span> <span class="o">!==</span> <span class="s1">&#39;Watch&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">playerobject</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">nmode</span> <span class="o">===</span> <span class="s1">&#39;Watch&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">playerobject</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">});</span>

            <span class="p">});</span>
        <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>We want to populate the available shapes with the rectangle and ellipse. These are considered stock
shapes for annotations.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">app</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">calcOpacity</span><span class="p">,</span>
            <span class="nx">calcRectangle</span><span class="p">,</span>
            <span class="nx">calcEllipse</span><span class="p">,</span>
            <span class="nx">lensRectangle</span><span class="p">,</span>
            <span class="nx">lensEllipse</span><span class="p">,</span>
            <span class="nx">rectButton</span><span class="p">,</span>
            <span class="nx">ellipseButton</span><span class="p">,</span>
            <span class="nx">selectButton</span><span class="p">,</span>
            <span class="nx">sliderButton</span><span class="p">,</span>
            <span class="nx">exportRectangle</span><span class="p">,</span>
            <span class="nx">watchButton</span><span class="p">,</span>
            <span class="nx">timeControlBinding</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <h3>calcOpacity (private)</h3>

<p>Calculate the opacity of the annotation shape rendering over the video.</p>

<p>Parameters:</p>

<ul>
<li>n - the current time of the play head</li>
<li>fstart - the start time for fading in (fstart .. start)</li>
<li>fend - the end time for fading out (end .. fend)</li>
<li>start - the start time for the annotation (start .. end)</li>
<li>end - the end time for the annotation (start .. end)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">calcOpacity</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">fstart</span><span class="p">,</span> <span class="nx">fend</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="nx">fstart</span> <span class="o">||</span> <span class="nx">n</span> <span class="o">&gt;</span> <span class="nx">fend</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="mf">0.0</span><span class="p">;</span>
                <span class="p">}</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="nx">start</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>fading in</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">val</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="nx">start</span> <span class="o">-</span> <span class="nx">n</span><span class="p">));</span>
                    <span class="nx">val</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&gt;</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <p>fading out</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">val</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="nx">end</span><span class="p">));</span>
                    <span class="nx">val</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">val</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <h3>calcRectangle (private)</h3>

<p>Calculate the center and extents given the corner and extents.</p>

<p>Parameters:</p>

<ul>
<li>coords - object holding the .x, .y, .width, and .height</li>
</ul>

<p>Returns:</p>

<p>An object holding the .x, .y, .w, and .h holding the center and extents.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">calcRectangle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">coords</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="p">{};</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="nx">coords</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">coords</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">));</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">coords</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="p">(</span><span class="nx">coords</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">));</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
                <span class="k">return</span> <span class="nx">attrs</span><span class="p">;</span>
            <span class="p">};</span>
            </pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <h3>exportRectangle (private)</h3>

<p>Calculate the attributes needed for exporting the rectangle constraint.</p>

<p>Parameters:</p>

<ul>
<li><p>item - an object holding the .x, .y, .w, and .h (center and extents)</p></li>
<li><p>w - width of play surface</p></li>
<li><p>h - height of play surface</p></li>
</ul>

<p>Returns:</p>

<p>Returns an object with the scaled .x, .y, .w, and .h.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">exportRectangle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="p">{},</span>
                <span class="nx">itemCopy</span><span class="p">;</span>
                <span class="nx">itemCopy</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span>
                <span class="nx">item</span><span class="p">);</span>

                <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="nx">itemCopy</span><span class="p">.</span><span class="nx">x</span> <span class="o">/</span> <span class="nx">w</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">itemCopy</span><span class="p">.</span><span class="nx">y</span> <span class="o">/</span> <span class="nx">h</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="p">(</span><span class="nx">itemCopy</span><span class="p">.</span><span class="nx">w</span> <span class="o">/</span> <span class="nx">w</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">itemCopy</span><span class="p">.</span><span class="nx">h</span> <span class="o">/</span> <span class="nx">h</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>

                <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">itemCopy</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">);</span>
            <span class="p">};</span>
            </pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <h3>lensRectangle (private)</h3>

<p>Renders the rectangular constraint on the video target.</p>

<p>Parameters:</p>

<ul>
<li><p>container -</p></li>
<li><p>view -</p></li>
<li><p>model -</p></li>
<li><p>itemId -</p></li>
</ul>

<p>Returns:</p>

<p>The rendering object.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">lensRectangle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">view</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">itemId</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>Note: Rectangle measurements x,y start at CENTER</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">initShapeLens</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">view</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">itemId</span><span class="p">),</span>
                <span class="nx">item</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">itemId</span><span class="p">),</span>
                <span class="nx">c</span><span class="p">,</span>
                <span class="nx">opacityFactor</span><span class="p">,</span> <span class="nx">fstart</span><span class="p">,</span> <span class="nx">fend</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">,</span> <span class="nx">updateOpacity</span><span class="p">,</span>
                <span class="nx">bbox</span><span class="p">;</span>

                <span class="nx">start</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">ntp_start</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                <span class="nx">end</span>   <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">ntp_end</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                <span class="nx">fstart</span> <span class="o">=</span> <span class="nx">start</span> <span class="o">-</span> <span class="nx">app</span><span class="p">.</span><span class="nx">getTimeEasement</span><span class="p">();</span>
                <span class="nx">fend</span>   <span class="o">=</span> <span class="nx">end</span>   <span class="o">+</span> <span class="nx">app</span><span class="p">.</span><span class="nx">getTimeEasement</span><span class="p">();</span>
                
                <span class="nx">updateOpacity</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="nx">c</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                            <span class="nx">opacity</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">opacity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nx">opacityFactor</span>
                        <span class="p">});</span>
                    <span class="p">}</span>
                <span class="p">};</span>
                
                <span class="nx">that</span><span class="p">.</span><span class="nx">eventTimeEasementChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">fstart</span> <span class="o">=</span> <span class="nx">start</span> <span class="o">-</span> <span class="nx">v</span><span class="p">;</span>
                    <span class="nx">fend</span>   <span class="o">=</span> <span class="nx">end</span> <span class="o">+</span> <span class="nx">v</span><span class="p">;</span>
                    <span class="nx">updateOpacity</span><span class="p">();</span>
                <span class="p">};</span>
                
                <span class="nx">that</span><span class="p">.</span><span class="nx">eventCurrentTimeChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">opacityFactor</span> <span class="o">=</span> <span class="nx">calcOpacity</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">fstart</span><span class="p">,</span> <span class="nx">fend</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">);</span>
                    <span class="nx">updateOpacity</span><span class="p">();</span>
                <span class="p">};</span>
                </pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>Accessing the view.canvas Object that was created in MITHGrid.Presentation.RaphSVG</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">c</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="nx">item</span><span class="p">.</span><span class="nx">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="nx">item</span><span class="p">.</span><span class="nx">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">item</span><span class="p">.</span><span class="nx">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>fill and set opacity</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">opacityFactor</span> <span class="o">=</span> <span class="nx">calcOpacity</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">getCurrentTime</span><span class="p">(),</span> <span class="nx">fstart</span><span class="p">,</span> <span class="nx">fend</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">);</span>
                <span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                    <span class="nx">fill</span><span class="o">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
                    <span class="nx">opacity</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">*</span> <span class="nx">opacityFactor</span>
                <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <p><strong>FIXME:</strong> may break with multiple videos if different annotations have the same ids in different
sets of annotations.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">$</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">node</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newItem</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p>receiving the Object passed through
model.updateItems in move()</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">item</span> <span class="o">=</span> <span class="nx">newItem</span><span class="p">;</span>
                    <span class="k">if</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">ntp_start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">start</span> <span class="o">||</span> <span class="nx">item</span><span class="p">.</span><span class="nx">ntp_end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">start</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">ntp_start</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                        <span class="nx">end</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">ntp_end</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                        <span class="nx">fstart</span> <span class="o">=</span> <span class="nx">start</span> <span class="o">-</span> <span class="nx">app</span><span class="p">.</span><span class="nx">getTimeEasement</span><span class="p">();</span>
                        <span class="nx">fend</span> <span class="o">=</span> <span class="nx">end</span> <span class="o">+</span> <span class="nx">app</span><span class="p">.</span><span class="nx">getTimeEasement</span><span class="p">();</span>
                        <span class="nx">opacityFactor</span> <span class="o">=</span> <span class="nx">calcOpacity</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">getCurrentTime</span><span class="p">(),</span> <span class="nx">fstart</span><span class="p">,</span> <span class="nx">fend</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">try</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">x</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">w</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">h</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                                <span class="nx">x</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">item</span><span class="p">.</span><span class="nx">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="nx">y</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">item</span><span class="p">.</span><span class="nx">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="nx">width</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="nx">height</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">h</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="nx">opacity</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">*</span> <span class="nx">opacityFactor</span>
                            <span class="p">});</span>
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <p>Raphael object is updated</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <p>calculate the extents (x, y, width, height)
of this type of shape</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">that</span><span class="p">.</span><span class="nx">getExtents</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="p">{</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                        <span class="nx">width</span><span class="o">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">),</span>
                        <span class="nx">height</span><span class="o">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">)</span>
                    <span class="p">};</span>
                <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <p>register shape</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">that</span><span class="p">.</span><span class="nx">shape</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>
                <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="nx">app</span><span class="p">.</span><span class="nx">addShapeType</span><span class="p">(</span><span class="s2">&quot;Rectangle&quot;</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="nx">calc</span><span class="o">:</span> <span class="nx">calcRectangle</span><span class="p">,</span>
                <span class="nx">lens</span><span class="o">:</span> <span class="nx">lensRectangle</span>
            <span class="p">});</span>

            <span class="nx">calcEllipse</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">coords</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="p">{};</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">coords</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="p">(</span><span class="nx">coords</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
                <span class="nx">attrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">coords</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
                <span class="k">return</span> <span class="nx">attrs</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="nx">lensEllipse</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">view</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">itemId</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">initShapeLens</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">view</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">itemId</span><span class="p">),</span>
                <span class="nx">item</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">itemId</span><span class="p">),</span>
                <span class="nx">c</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>               <p>create the shape</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">c</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">ellipse</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">item</span><span class="p">.</span><span class="nx">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">item</span><span class="p">.</span><span class="nx">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <p>fill shape</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                    <span class="nx">fill</span><span class="o">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
                    <span class="nx">opacity</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">opacity</span>
                <span class="p">});</span>


                <span class="nx">that</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>               <p>receiving the Object passed through
model.updateItems in move()</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="k">try</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">x</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">y</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
                                <span class="nx">cx</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="nx">cy</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="nx">rx</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="nx">ry</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="nx">opacity</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">opacity</span>
                            <span class="p">});</span>
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>

                    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <p>Raphael object is updated</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="p">};</span>

                <span class="nx">that</span><span class="p">.</span><span class="nx">eventCurrentTimeChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">npt</span><span class="p">)</span> <span class="p">{</span>
                    
                <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <p>calculate the extents (x, y, width, height)
of this type of shape</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">that</span><span class="p">.</span><span class="nx">getExtents</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="p">{</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">),</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cy&quot;</span><span class="p">),</span>
                        <span class="nx">width</span><span class="o">:</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;rx&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span>
                        <span class="nx">height</span><span class="o">:</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;ry&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="p">};</span>
                <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <p>register shape</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">that</span><span class="p">.</span><span class="nx">shape</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>

                <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
            <span class="p">};</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">addShapeType</span><span class="p">(</span><span class="s2">&quot;Ellipse&quot;</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">calc</span><span class="o">:</span> <span class="nx">calcEllipse</span><span class="p">,</span>
                <span class="nx">lens</span><span class="o">:</span> <span class="nx">lensEllipse</span>
            <span class="p">});</span>

            <span class="nx">app</span><span class="p">.</span><span class="nx">addBody</span><span class="p">(</span><span class="s2">&quot;Text&quot;</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">initTextLens</span><span class="p">);</span>

            </pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <p>Adding in button features for annotation creation</p>             </td>             <td class="code">               <div class="highlight"><pre>            

            <span class="nx">rectButton</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">buttonFeature</span><span class="p">(</span><span class="s1">&#39;buttongrouping&#39;</span><span class="p">,</span> <span class="s1">&#39;Shapes&#39;</span><span class="p">,</span> <span class="s1">&#39;Rectangle&#39;</span><span class="p">);</span>

            <span class="nx">ellipseButton</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">buttonFeature</span><span class="p">(</span><span class="s1">&#39;buttongrouping&#39;</span><span class="p">,</span> <span class="s1">&#39;Shapes&#39;</span><span class="p">,</span> <span class="s1">&#39;Ellipse&#39;</span><span class="p">);</span>

            <span class="nx">selectButton</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">buttonFeature</span><span class="p">(</span><span class="s1">&#39;buttongrouping&#39;</span><span class="p">,</span> <span class="s1">&#39;General&#39;</span><span class="p">,</span> <span class="s1">&#39;Select&#39;</span><span class="p">);</span>

            <span class="nx">watchButton</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">buttonFeature</span><span class="p">(</span><span class="s1">&#39;buttongrouping&#39;</span><span class="p">,</span> <span class="s1">&#39;General&#39;</span><span class="p">,</span> <span class="s1">&#39;Watch&#39;</span><span class="p">);</span>

            <span class="nx">app</span><span class="p">.</span><span class="nx">setCurrentTime</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <p>binding time controller to time DOM</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">timeControlBinding</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">timecontrol</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;.timeselect&#39;</span><span class="p">,</span> <span class="p">{});</span>
            <span class="nx">timeControlBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUpdate</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">app</span><span class="p">.</span><span class="nx">dataStore</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">updateItems</span><span class="p">([{</span>
                    <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
                    <span class="nx">ntp_start</span><span class="o">:</span> <span class="nx">start</span><span class="p">,</span>
                    <span class="nx">ntp_end</span><span class="o">:</span> <span class="nx">end</span>
                <span class="p">}]);</span>
            <span class="p">});</span>

        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">app</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nx">MITHGrid</span><span class="p">,</span> <span class="nx">OAC</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <h1>Default Configurations</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <h2>Controller.CanvasClickController</h2>

<p>Bindings created by this controller will have the following events:</p>

<ul>
<li>onClick</li>
<li>onShapeStart</li>
<li>onShapeDrag</li>
<li>onShapeDone</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.CanvasClickController&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">bind</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">onClick</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">onShapeStart</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">onShapeDrag</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">onShapeDone</span><span class="o">:</span> <span class="kc">null</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <h2>Controller.TextBodyEditor</h2>

<p>Bindings created by this controller will have the following events:</p>

<ul>
<li>onClick</li>
<li>onDelete</li>
<li>onUpdate</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.TextBodyEditor&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">bind</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">onClick</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">onDelete</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">onUpdate</span><span class="o">:</span> <span class="kc">null</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <h2>Controller.AnnotationEditSelectionGrid</h2>

<p>Bindings created by this controller will have the following events:</p>

<ul>
<li>onResize</li>
<li>onMove</li>
<li>onEdit</li>
<li>onDelete</li>
<li>onCurrentModeChange</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.AnnotationEditSelectionGrid&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">dirs</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;ul&#39;</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;ur&#39;</span><span class="p">,</span> <span class="s1">&#39;lft&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="s1">&#39;btm&#39;</span><span class="p">,</span> <span class="s1">&#39;ll&#39;</span><span class="p">,</span> <span class="s1">&#39;rgt&#39;</span><span class="p">,</span> <span class="s1">&#39;mid&#39;</span><span class="p">],</span>
    <span class="nx">bind</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">onResize</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">onMove</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">onEdit</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">onDelete</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nx">onCurrentModeChange</span><span class="o">:</span> <span class="kc">null</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <h2>Controller.KeyboardListener</h2>

<p>Bindings created by this controller will have the following events:</p>

<ul>
<li>onDelete</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.KeyboardListener&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">bind</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">onDelete</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;preventable&quot;</span><span class="p">,</span> <span class="s2">&quot;unicast&quot;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <h2>Controller.AnnotationCreationButton</h2>

<p>Bindings created by this controller will have the following events:</p>

<ul>
<li>onCurrentModeChange</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.AnnotationCreationButton&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">bind</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">onCurrentModeChange</span><span class="o">:</span> <span class="kc">null</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <h2>Controller.ShapeCreateBox</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.ShapeCreateBox&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">bind</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <h2>Controller.WindowResize</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.WindowResize&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">bind</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">onResize</span><span class="o">:</span> <span class="kc">null</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">selectors</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;&#39;</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <h2>Controller.timeControl</h2>

<p>Bindings created by this controller will have the following events:</p>

<ul>
<li>onUpdate</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Controller.timeControl&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">bind</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">onUpdate</span><span class="o">:</span> <span class="kc">null</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <h2>Annotation Client</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">controllers</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">keyboard</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">KeyboardListener</span><span class="p">,</span>
            <span class="nx">selectors</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">doc</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">shapeEditBox</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">AnnotationEditSelectionGrid</span>
        <span class="p">},</span>
        <span class="nx">shapeCreateBox</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">ShapeCreateBox</span>
        <span class="p">},</span>
        <span class="nx">canvas</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">CanvasClickController</span><span class="p">,</span>
            <span class="nx">selectors</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">svg</span><span class="o">:</span> <span class="s1">&#39; &gt; svg&#39;</span><span class="p">,</span>
                <span class="nx">svgwrapper</span><span class="o">:</span> <span class="s1">&#39;.section-canvas&#39;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">annoActive</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">TextBodyEditor</span><span class="p">,</span>
            <span class="nx">selectors</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">annotation</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="nx">annotationlist</span><span class="o">:</span> <span class="s1">&#39;:parent&#39;</span><span class="p">,</span>
                <span class="nx">bodycontent</span><span class="o">:</span> <span class="s1">&#39;.bodyContent&#39;</span><span class="p">,</span>
                <span class="nx">body</span><span class="o">:</span> <span class="s1">&#39;.body&#39;</span><span class="p">,</span>
                <span class="nx">editbutton</span><span class="o">:</span> <span class="s1">&#39;.button.edit&#39;</span><span class="p">,</span>
                <span class="nx">editarea</span><span class="o">:</span> <span class="s1">&#39;.editArea&#39;</span><span class="p">,</span>
                <span class="nx">textarea</span><span class="o">:</span> <span class="s1">&#39;.editArea &gt; textarea&#39;</span><span class="p">,</span>
                <span class="nx">updatebutton</span><span class="o">:</span> <span class="s1">&#39;.button.update&#39;</span><span class="p">,</span>
                <span class="nx">deletebutton</span><span class="o">:</span> <span class="s1">&#39;.button.delete&#39;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">buttonActive</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">AnnotationCreationButton</span><span class="p">,</span>
            <span class="nx">selectors</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">button</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">slider</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">sliderButton</span><span class="p">,</span>
            <span class="nx">selectors</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">slider</span><span class="o">:</span> <span class="s1">&#39;#slider&#39;</span><span class="p">,</span>
                <span class="nx">timedisplay</span><span class="o">:</span> <span class="s1">&#39;.timedisplay&#39;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">timecontrol</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">timeControl</span><span class="p">,</span>
            <span class="nx">selectors</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">timestart</span><span class="o">:</span> <span class="s1">&#39;#timestart&#39;</span><span class="p">,</span>
                <span class="nx">timeend</span><span class="o">:</span> <span class="s1">&#39;#timeend&#39;</span><span class="p">,</span>
                <span class="nx">submit</span><span class="o">:</span> <span class="s1">&#39;#submittime&#39;</span><span class="p">,</span>
                <span class="nx">menudiv</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">windowResize</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">WindowResize</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">variables</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <p><strong>ActiveAnnotation</strong> holds the item ID of the annotation currently receiving selection focus.</p>

<ul>
<li>setActiveAnnotation(id) sets the id</li>
<li>getActiveAnnotation() returns the id</li>
<li>events.onActiveAnnotationChange fires when the ActiveAnnotation value changes</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">ActiveAnnotation</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">is</span><span class="o">:</span> <span class="s1">&#39;rw&#39;</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <p><strong>CurrentTime</strong> holds the current position of the video play head in seconds. The value defaults to 0 seconds.</p>

<ul>
<li>setCurrentTime(time) sets the play head position for the annotation client (does not affect the player)</li>
<li>getCurrentTime() returns the current play head position</li>
<li>events.onCurrentTimeChange fires when the CurrentTime value changes</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">CurrentTime</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">is</span><span class="o">:</span> <span class="s1">&#39;rw&#39;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="o">:</span> <span class="mi">0</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <p><strong>TimeEasement</strong> holds the number of seconds an annotation eases in or out of full view.</p>

<ul>
<li>setTimeEasement(t)</li>
<li>getTimeEasement()</li>
<li>events.onTimeEasementChange</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">TimeEasement</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">is</span><span class="o">:</span> <span class="s1">&#39;rw&#39;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="o">:</span> <span class="mi">5</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <p><strong>CurrentMode</strong> holds the current interaction mode for the annotation client. Values may be a shape type,
"Watch", or "Select".</p>

<ul>
<li>setCurrentMode(mode) sets the annotation client mode</li>
<li>getCurrentMode() returns the current annotation client mode</li>
<li>events.onCurrentModeChange fires when the CurrentMode value changes</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">CurrentMode</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">is</span><span class="o">:</span> <span class="s1">&#39;rw&#39;</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <p><strong>Player</strong> holds the current video player driver instance.</p>

<ul>
<li>setPlayer(player) sets the current video player driver instance</li>
<li>getPlayer() returns the current video player driver instance</li>
<li>events.onPlayerChange fires when the Player value changes</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">Player</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">is</span><span class="o">:</span> <span class="s1">&#39;rw&#39;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">dataViews</span><span class="o">:</span> <span class="p">{</span>
        <span class="cm">/*</span>
<span class="cm">        drawspace: {</span>
<span class="cm">            dataStore: &#39;canvas&#39;,</span>
<span class="cm">            types: [&quot;Annotation&quot;]</span>
<span class="cm">        },</span>
<span class="cm">        */</span></pre></div>             </td>           </tr>                               <tr id="section-165">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-165">&#182;</a>               </div>               <p><strong>currentAnnotations</strong> pages a range of times through the annotation store selecting those
annotations which have a time range (.ntp_start through .ntp_end) that fall within the time
range set.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">currentAnnotations</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">dataStore</span><span class="o">:</span> <span class="s1">&#39;canvas&#39;</span><span class="p">,</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Data</span><span class="p">.</span><span class="nx">RangePager</span><span class="p">,</span>
            <span class="nx">leftExpressions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;.ntp_start&#39;</span> <span class="p">],</span>
            <span class="nx">rightExpressions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;.ntp_end&#39;</span> <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-166">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-166">&#182;</a>               </div>               <p>Data store for the Application</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dataStores</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-167">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-167">&#182;</a>               </div>               <p><strong>canvas</strong> holds all of the annotation data for the client.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">canvas</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">types</span><span class="o">:</span><span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-168">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-168">&#182;</a>               </div>               <p>All annotation items are of type "Annotation"</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">Annotation</span><span class="o">:</span> <span class="p">{}</span>
            <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-169">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-169">&#182;</a>               </div>               <p>The following properties are understood by the annotation client:</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">properties</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-170">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-170">&#182;</a>               </div>               <ul>
<li>shapeType indicates which shape is used as the SVG constraint within the frame (e.g., Rectangle or Ellipse)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">shapeType</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">valueType</span><span class="o">:</span> <span class="s1">&#39;text&#39;</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-171">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-171">&#182;</a>               </div>               <ul>
<li>bodyType indicates what kind of body the annotation associates with the target (e.g., Text)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">bodyType</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">valueType</span><span class="o">:</span> <span class="s1">&#39;text&#39;</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-172">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-172">&#182;</a>               </div>               <ul>
<li>bodyContent holds the byte stream associated with the annotation body</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">bodyContent</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">valueType</span><span class="o">:</span> <span class="s1">&#39;text&#39;</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-173">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-173">&#182;</a>               </div>               <ul>
<li>targetURI points to the annotation target video without time constraints</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">targetURI</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">valueType</span><span class="o">:</span> <span class="s1">&#39;uri&#39;</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-174">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-174">&#182;</a>               </div>               <ul>
<li>opacity is used in the SVG rendering of the annotation target constraint (shape)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">opacity</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">valueType</span><span class="o">:</span> <span class="s1">&#39;numeric&#39;</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-175">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-175">&#182;</a>               </div>               <ul>
<li>the play head position at which this annotation becomes active/current</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">ntp_start</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">valueType</span><span class="o">:</span> <span class="s2">&quot;numeric&quot;</span>
                <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-176">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-176">&#182;</a>               </div>               <ul>
<li>the play head position at which this annotation ceases being active/current</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">ntp_end</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">valueType</span><span class="o">:</span> <span class="s2">&quot;numeric&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">presentations</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">raphsvg</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Presentation</span><span class="p">.</span><span class="nx">RaphaelCanvas</span><span class="p">,</span>
            <span class="nx">dataView</span><span class="o">:</span> <span class="s1">&#39;currentAnnotations&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-177">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-177">&#182;</a>               </div>               <p>The controllers are configured for the application and passed in to the presentation's
initInstance method as named here.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">controllers</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">keyboard</span><span class="o">:</span> <span class="s2">&quot;keyboard&quot;</span><span class="p">,</span>
                <span class="nx">canvas</span><span class="o">:</span> <span class="s2">&quot;canvas&quot;</span><span class="p">,</span>
                <span class="nx">shapeCreateBox</span><span class="o">:</span> <span class="s2">&quot;shapeCreateBox&quot;</span><span class="p">,</span>
                <span class="nx">shapeEditBox</span><span class="o">:</span> <span class="s2">&quot;shapeEditBox&quot;</span><span class="p">,</span>
                <span class="nx">windowResize</span><span class="o">:</span> <span class="s2">&quot;windowResize&quot;</span>
            <span class="p">},</span>
            <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">onOpacityChange</span><span class="o">:</span> <span class="kc">null</span>
            <span class="p">},</span>
            <span class="nx">fadeStart</span><span class="o">:</span> <span class="mi">5</span>
        <span class="p">},</span>
        <span class="nx">annoItem</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Presentation</span><span class="p">.</span><span class="nx">AnnotationList</span><span class="p">,</span>
            <span class="nx">dataView</span><span class="o">:</span> <span class="s1">&#39;currentAnnotations&#39;</span><span class="p">,</span>
            <span class="nx">container</span><span class="o">:</span> <span class="s1">&#39;.anno_list&#39;</span>
        <span class="p">}</span> <span class="c1">//annoItem</span>
    <span class="p">}</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 