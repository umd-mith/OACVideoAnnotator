<!DOCTYPE html><html><head><title>component.js</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../index.html" class="source"><span class="file_name">README</span></a><a href="../src/canvas.js.html" class="source "><span class="base_path">src / </span><span class="file_name">canvas.js</span></a><a href="../src/component.js.html" class="source selected"><span class="base_path">src / </span><span class="file_name">component.js</span></a><a href="../src/controllers.js.html" class="source "><span class="base_path">src / </span><span class="file_name">controllers.js</span></a><a href="../src/intro.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">intro.coffee</span></a><a href="../src/intro.js.html" class="source "><span class="base_path">src / </span><span class="file_name">intro.js</span></a><a href="../src/oac-dummy-player.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">oac-dummy-player.coffee</span></a><a href="../src/oac-dummy-player.js.html" class="source "><span class="base_path">src / </span><span class="file_name">oac-dummy-player.js</span></a><a href="../src/oac-player-framework.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">oac-player-framework.coffee</span></a><a href="../src/oac-player-framework.js.html" class="source "><span class="base_path">src / </span><span class="file_name">oac-player-framework.js</span></a><a href="../src/oac-youtube-player.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">oac-youtube-player.coffee</span></a><a href="../src/outro.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">outro.coffee</span></a><a href="../src/outro.js.html" class="source "><span class="base_path">src / </span><span class="file_name">outro.js</span></a><a href="../src/presentations.js.html" class="source "><span class="base_path">src / </span><span class="file_name">presentations.js</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>component.js</h1><div class="filepath">src/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><h1>Components</h1>
</td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">MITHGrid</span><span class="p">,</span> <span class="nx">OAC</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">Component</span> <span class="o">=</span> <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;Component&#39;</span><span class="p">);</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><h2>BoundingBox</h2>

<p>Creates and manages a SVG bounding box with resize handles and center drag handle.</p>
</td><td class="code"><div class="highlight"><pre><span class="nx">Component</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;BoundingBox&quot;</span><span class="p">);</span>

<span class="nx">Component</span><span class="p">.</span><span class="nx">BoundingBox</span><span class="p">.</span><span class="nx">initInstance</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">initInstance</span><span class="p">(</span><span class="s2">&quot;OAC.Client.StreamingVideo.Component.BoundingBox&quot;</span><span class="p">,</span> <span class="nx">container</span><span class="p">,</span> <span class="nx">options</span><span class="p">),</span>
  <span class="nx">dragController</span> <span class="o">=</span> <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">Drag</span><span class="p">.</span><span class="nx">initController</span><span class="p">({}),</span>
  <span class="nx">handleSet</span> <span class="o">=</span> <span class="p">{},</span>
  <span class="nx">calcFactors</span><span class="p">,</span> <span class="nx">drawHandles</span><span class="p">,</span>
  <span class="nx">svgBBox</span><span class="p">,</span> <span class="nx">midDrag</span><span class="p">;</span>
  </pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><h5>calcFactors (private)</h5>

<p>Measures where the handles should be on mousemove.</p>

<p>Parameters: None.</p>

<p>Returns: Nothing.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">calcFactors</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">extents</span> <span class="o">=</span> <span class="nx">activeRendering</span><span class="p">.</span><span class="nx">getExtents</span><span class="p">();</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>create offset factors for
bounding box
calculate width - height to be larger
than shape</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">padding</span><span class="p">);</span>
    <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">height</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">padding</span><span class="p">);</span>
    <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">/</span> <span class="mi">8</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">/</span> <span class="mi">8</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="nx">calcHandles</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
  <span class="p">};</span>
  </pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><h4>drawHandles (private)</h4>

<p>Draws the handles defined in dirs as SVG rectangles and draws the SVG bounding box</p>

<p>Parameters: None.</p>

<p>Returns: Nothing.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">drawHandles</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">midDragDragBinding</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">handleSet</span><span class="p">))</span> <span class="p">{</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>draw the corner and mid-point squares</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">handleSet</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">set</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">handles</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">h</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="s1">&#39;mid&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">midDrag</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">padding</span><span class="p">,</span> <span class="nx">padding</span><span class="p">);</span>
          <span class="nx">o</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">midDrag</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">h</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">padding</span><span class="p">,</span> <span class="nx">padding</span><span class="p">);</span>
          <span class="nx">o</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">h</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

          <span class="nx">h</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
            <span class="nx">cursor</span><span class="o">:</span> <span class="nx">o</span><span class="p">.</span><span class="nx">cursor</span>
          <span class="p">});</span>
          <span class="nx">handleSet</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">h</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>make them all similar looking</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">handleSet</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
        <span class="nx">fill</span><span class="o">:</span> <span class="mi">990000</span><span class="p">,</span>
        <span class="nx">stroke</span><span class="o">:</span> <span class="s1">&#39;black&#39;</span>
      <span class="p">});</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">midDrag</span><span class="p">)))</span> <span class="p">{</span>
        <span class="nx">midDrag</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
          <span class="nx">fill</span><span class="o">:</span> <span class="mi">990000</span><span class="p">,</span>
          <span class="nx">stroke</span><span class="o">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
          <span class="nx">cursor</span><span class="o">:</span> <span class="s1">&#39;move&#39;</span>
        <span class="p">});</span>
      <span class="p">}</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>drawing bounding box</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">svgBBox</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
      <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
        <span class="nx">stroke</span><span class="o">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span>
        <span class="s1">&#39;stroke-dasharray&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;--&quot;</span><span class="p">]</span>
      <span class="p">});</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">midDrag</span><span class="p">)))</span> <span class="p">{</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Attaching listener to drag-only handle (midDrag)</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">midDragDragBinding</span> <span class="o">=</span> <span class="nx">dragController</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">midDrag</span><span class="p">);</span>
        
        <span class="nx">midDragDragBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUpdate</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>dragging means that the svgBBox stays padding-distance
away from the lens' shape and the lens shape gets updated
in dataStore</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">;</span>
            <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">dy</span><span class="p">;</span>
            <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">;</span>
            <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">dy</span><span class="p">;</span>

            <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
              <span class="nx">x</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span><span class="p">,</span>
              <span class="nx">y</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span>
            <span class="p">});</span>

            <span class="nx">calcHandles</span><span class="p">({</span>
              <span class="nx">x</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span><span class="p">,</span>
              <span class="nx">y</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span><span class="p">,</span>
              <span class="nx">width</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
              <span class="nx">height</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
            <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">);</span>
        
        <span class="nx">midDragDragBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onFocus</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>start</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">ox</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
            <span class="nx">oy</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
            <span class="nx">calcFactors</span><span class="p">();</span>
            <span class="nx">activeRendering</span><span class="p">.</span><span class="nx">shape</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
              <span class="nx">cursor</span><span class="o">:</span> <span class="s1">&#39;move&#39;</span>
            <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">);</span>
        
        <span class="nx">midDragDragBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUnfocus</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span>
          <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>end</p>
</td><td class="code"><div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="p">{</span>
              <span class="nx">x</span><span class="o">:</span> <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
              <span class="nx">y</span><span class="o">:</span> <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">y</span>
            <span class="p">};</span>

            <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onMove</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">pos</span><span class="p">);</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>activeRendering.shape.attr({
cursor: 'default'
});</p>
</td><td class="code"><div class="highlight"><pre>          <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Attaching drag and resize handlers</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">handleSet</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">handle</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">handleBinding</span> <span class="o">=</span> <span class="nx">dragController</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">handle</span><span class="p">);</span>
        
        <span class="nx">handleBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUpdate</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>onmove function - handles dragging
dragging here means that the shape is being resized;
the factorial determines in which direction the
shape is pulled</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="nx">dx</span> <span class="o">*</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
          <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">height</span> <span class="o">+</span> <span class="nx">dy</span> <span class="o">*</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
          <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nw</span> <span class="o">=</span> <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">+</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
          <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nh</span> <span class="o">=</span> <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">+</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
          <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span> <span class="o">=</span> <span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
          <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span> <span class="o">=</span> <span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nh</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

          <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
            <span class="nx">x</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span><span class="p">,</span>
            <span class="nx">y</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span><span class="p">,</span>
            <span class="nx">width</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nw</span><span class="p">,</span>
            <span class="nx">height</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nh</span>
          <span class="p">});</span>
          <span class="nx">calcHandles</span><span class="p">({</span>
            <span class="nx">x</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span><span class="p">,</span>
            <span class="nx">y</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span><span class="p">,</span>
            <span class="nx">width</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nw</span><span class="p">,</span>
            <span class="nx">height</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nh</span>
          <span class="p">});</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">itemMenu</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">drawMenu</span><span class="p">({</span>
              <span class="nx">x</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nx</span><span class="p">,</span>
              <span class="nx">y</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">ny</span><span class="p">,</span>
              <span class="nx">width</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nw</span><span class="p">,</span>
              <span class="nx">height</span><span class="o">:</span> <span class="nx">handleAttrs</span><span class="p">.</span><span class="nx">nh</span>
            <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">});</span>
        
        <span class="nx">handleBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onFocus</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>onstart function</p>
</td><td class="code"><div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">px</span><span class="p">,</span>
            <span class="nx">py</span><span class="p">;</span>
            <span class="nx">extents</span> <span class="o">=</span> <span class="nx">activeRendering</span><span class="p">.</span><span class="nx">getExtents</span><span class="p">();</span>
            <span class="nx">ox</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
            <span class="nx">oy</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>change mode</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">setCurrentMode</span><span class="p">(</span><span class="s1">&#39;Drag&#39;</span><span class="p">);</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>extents: x, y, width, height</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">px</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="nx">ox</span> <span class="o">-</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
            <span class="nx">py</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="nx">oy</span> <span class="o">-</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">/</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">px</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">factors</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">px</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">factors</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
              <span class="nx">factors</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">py</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">factors</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">py</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">factors</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
              <span class="nx">factors</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">calcFactors</span><span class="p">();</span>
        <span class="p">});</span>
        
        <span class="nx">handleBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUnfocus</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>onend function
update</p>
</td><td class="code"><div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">width</span><span class="o">:</span> <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span>
            <span class="nx">height</span><span class="o">:</span> <span class="nx">shapeAttrs</span><span class="p">.</span><span class="nx">h</span>
          <span class="p">};</span>
          <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onResize</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">pos</span><span class="p">);</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>change mode back</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">.</span><span class="nx">setCurrentMode</span><span class="p">(</span><span class="s1">&#39;Select&#39;</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>show all the boxes and
handles</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>adjust the SvgBBox to be around new
shape</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
        <span class="nx">x</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
        <span class="nx">y</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
        <span class="nx">width</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
        <span class="nx">height</span><span class="o">:</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
      <span class="p">});</span>
      <span class="nx">handleSet</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
      <span class="nx">midDrag</span><span class="p">.</span><span class="nx">show</span><span class="p">().</span><span class="nx">toFront</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">itemMenu</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">itemMenu</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">drawMenu</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
  
  
  <span class="nx">that</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">calcFactors</span><span class="p">();</span>
    <span class="nx">drawHandles</span><span class="p">();</span>
  <span class="p">};</span>
  
  <span class="nx">that</span><span class="p">.</span><span class="nx">hide</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">handleSet</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">handleSet</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>

    <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nx">midDrag</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
  <span class="p">};</span>
  
  
<span class="p">};</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><h2>AnnotationEditSelectionGrid</h2>

<p>Attaches to an SVG lens and creates a green rectangle dashed box to
act as the resize and drag tool. Only edits the SVG data - no annotation
bodyContent data.</p>
</td><td class="code"><div class="highlight"><pre><span class="nx">Misc</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;AnnotationEditSelectionGrid&quot;</span><span class="p">);</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><h3>AnnotationEditSelectionGrid.initController</h3>

<p>Initializes the AnnotationEditSelectionGrid controller object. This object may then be used to bind actions to
the DOM.</p>

<p>We create the bounding box once and keep it around. We then track which rendering is associated with
the bounding box and draw it accordingly.
We associate the bounding box with the SVG/Raphaël canvas holding the renderings we want to use it with.</p>

<p>Each Raphaël canvas should have its own AnnotationEditSelectionGrid instance for binding renderings.</p>

<p>Parameters:</p>

<ul>
<li>options - object holding configuration information</li>
</ul>

<p>Returns:</p>

<p>The initialized controller object.</p>

<p><strong>FIXME:</strong></p>

<p>The controller needs to be broken up a bit. The idea of providing a bounding box for renderings is something that
should be handled in the presentation, not here. The controller should just generate events based on user interactions.
The presentation should worry about which rendering is currently active and manage the translation of controller
events to the rendering.</p>

<p>For now, we'll refactor this into two pieces: the bounding box drawing (rendering), and translating events in the binding.</p>

<p>We will eventually split this controller into two: bounding box resize controller and bounding box drag/move controller.</p>
</td><td class="code"><div class="highlight"><pre><span class="nx">Controller</span><span class="p">.</span><span class="nx">AnnotationEditSelectionGrid</span><span class="p">.</span><span class="nx">initController</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">initController</span><span class="p">(</span>
  <span class="s2">&quot;OAC.Client.StreamingVideo.Controller.AnnotationEditSelectionGrid&quot;</span><span class="p">,</span>
  <span class="nx">options</span>
  <span class="p">),</span>
  <span class="nx">dragController</span><span class="p">,</span>
  <span class="nx">dirs</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="nx">options</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>
  <span class="nx">dirs</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">dirs</span><span class="p">;</span> <span class="c1">// || [&#39;ul&#39;, &#39;top&#39;, &#39;ur&#39;, &#39;lft&#39;, &#39;lr&#39;, &#39;btm&#39;, &#39;ll&#39;, &#39;rgt&#39;, &#39;mid&#39;];</span>
  
  <span class="nx">dragController</span> <span class="o">=</span> <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">Drag</span><span class="p">.</span><span class="nx">initController</span><span class="p">({});</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><h4>AnnotationEditSelectionGrid #applyBindings</h4>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">that</span><span class="p">.</span><span class="nx">applyBindings</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">binding</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ox</span><span class="p">,</span>
    <span class="nx">oy</span><span class="p">,</span>
    <span class="nx">handleSet</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">midDrag</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">svgBBox</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">itemMenu</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">handles</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">activeRendering</span><span class="p">,</span>
    <span class="nx">deleteButton</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">editButton</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">menuContainer</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">factors</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">extents</span><span class="p">,</span>
    <span class="nx">paper</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">paper</span><span class="p">,</span>
    <span class="nx">attrs</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">padding</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="nx">calcFactors</span><span class="p">,</span>
    <span class="nx">calcHandles</span><span class="p">,</span>
    <span class="nx">drawMenu</span><span class="p">,</span>
    <span class="nx">itemDeleted</span><span class="p">,</span>
    <span class="nx">handleIds</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">drawHandles</span><span class="p">,</span>
    <span class="nx">handleAttrs</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">shapeAttrs</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">menuAttrs</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">cursor</span><span class="p">,</span>
    <span class="nx">dAttrs</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">eAttrs</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">handleCalculationData</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">el</span><span class="p">;</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>Function for applying a new shape to the bounding box</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">binding</span><span class="p">.</span><span class="nx">attachRendering</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newRendering</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">binding</span><span class="p">.</span><span class="nx">detachRendering</span><span class="p">();</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">newRendering</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><p>register the rendering</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">activeRendering</span> <span class="o">=</span> <span class="nx">newRendering</span><span class="p">;</span>
      <span class="nx">calcFactors</span><span class="p">();</span>
      <span class="nx">drawHandles</span><span class="p">();</span>
    <span class="p">};</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>Function to call in order to "de-activate" the edit box
(i.e. make it hidden)</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">binding</span><span class="p">.</span><span class="nx">detachRendering</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">handleSet</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">activeRendering</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="nx">handleSet</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>

      <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
      <span class="nx">midDrag</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">itemMenu</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">itemMenu</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">};</span>
    </pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><h4>drawMenu (private)</h4>

<p>Draws menu that sits at the top-right corner of the shape.</p>

<p>Parameters:</p>

<ul>
<li>args - object holding the .x, .y, and .width properties</li>
</ul>

<p>Returns: Nothing.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">drawMenu</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span><span class="p">(</span><span class="nx">itemMenu</span><span class="p">))</span> <span class="p">{</span>

        <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
        <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
        <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span></pre></div></td></tr><tr id="section-31"><td class="docs"><div class="pilwrap"><a href="#section-31" class="pilcrow">&#182;</a></div><p>Create separate attribute objects
for each menu button/container</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">eAttrs</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">x</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
          <span class="nx">y</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
          <span class="nx">w</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span>
          <span class="nx">h</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">-</span> <span class="p">(</span><span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span>
        <span class="p">};</span>

        <span class="nx">dAttrs</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">x</span><span class="o">:</span> <span class="p">(</span><span class="nx">eAttrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">eAttrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
          <span class="nx">y</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
          <span class="nx">w</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">w</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span>
          <span class="nx">h</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">-</span> <span class="p">(</span><span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">h</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span>
        <span class="p">};</span>

        <span class="nx">itemMenu</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">set</span><span class="p">();</span>
        <span class="nx">menuContainer</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">h</span><span class="p">);</span>
        <span class="nx">menuContainer</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
          <span class="nx">fill</span><span class="o">:</span> <span class="s1">&#39;#FFFFFF&#39;</span><span class="p">,</span>
          <span class="nx">stroke</span><span class="o">:</span> <span class="s1">&#39;#000&#39;</span>
        <span class="p">});</span>

        <span class="nx">itemMenu</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">menuContainer</span><span class="p">);</span>

        <span class="nx">editButton</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">eAttrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">eAttrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">eAttrs</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="nx">eAttrs</span><span class="p">.</span><span class="nx">h</span><span class="p">);</span>
        <span class="nx">editButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
          <span class="nx">fill</span><span class="o">:</span> <span class="mi">334009</span><span class="p">,</span>
          <span class="nx">cursor</span><span class="o">:</span> <span class="s1">&#39;pointer&#39;</span>
        <span class="p">});</span>

        <span class="nx">itemMenu</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">editButton</span><span class="p">);</span>

        <span class="nx">deleteButton</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">dAttrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">dAttrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">dAttrs</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="nx">dAttrs</span><span class="p">.</span><span class="nx">h</span><span class="p">);</span>
        <span class="nx">deleteButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
          <span class="nx">fill</span><span class="o">:</span> <span class="mi">334009</span><span class="p">,</span>
          <span class="nx">cursor</span><span class="o">:</span> <span class="s1">&#39;pointer&#39;</span>
        <span class="p">});</span>

        <span class="nx">itemMenu</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">deleteButton</span><span class="p">);</span></pre></div></td></tr><tr id="section-32"><td class="docs"><div class="pilwrap"><a href="#section-32" class="pilcrow">&#182;</a></div><p>attach event firers</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">editButton</span><span class="p">.</span><span class="nx">mousedown</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">activeRendering</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onEdit</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">activeRendering</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">});</span>
        <span class="nx">editButton</span><span class="p">.</span><span class="nx">hover</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">editButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
            <span class="nx">fill</span><span class="o">:</span> <span class="mi">443009</span>
          <span class="p">});</span>
        <span class="p">},</span>
        <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">editButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
            <span class="nx">fill</span><span class="o">:</span> <span class="mi">334009</span>
          <span class="p">});</span>
        <span class="p">});</span>


        <span class="nx">deleteButton</span><span class="p">.</span><span class="nx">mousedown</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">activeRendering</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">binding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onDelete</span><span class="p">.</span><span class="nx">fire</span><span class="p">();</span>
            <span class="nx">itemDeleted</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">});</span>
        <span class="nx">deleteButton</span><span class="p">.</span><span class="nx">hover</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">deleteButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
            <span class="nx">fill</span><span class="o">:</span> <span class="mi">443009</span>
          <span class="p">});</span>
        <span class="p">},</span>
        <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">deleteButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
            <span class="nx">fill</span><span class="o">:</span> <span class="mi">334009</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>


        <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
        <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">padding</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>

        <span class="nx">eAttrs</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">x</span><span class="o">:</span> <span class="p">(</span><span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
          <span class="nx">y</span><span class="o">:</span> <span class="p">(</span><span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">};</span>

        <span class="nx">dAttrs</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">x</span><span class="o">:</span> <span class="p">(</span><span class="nx">eAttrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">editButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
          <span class="nx">y</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="p">};</span>
        <span class="nx">menuContainer</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
          <span class="nx">x</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
          <span class="nx">y</span><span class="o">:</span> <span class="nx">menuAttrs</span><span class="p">.</span><span class="nx">y</span>
        <span class="p">});</span>
        <span class="nx">editButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">eAttrs</span><span class="p">);</span>
        <span class="nx">deleteButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">dAttrs</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">itemDeleted</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div></td></tr><tr id="section-33"><td class="docs"><div class="pilwrap"><a href="#section-33" class="pilcrow">&#182;</a></div><p>set rendering to undefined</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">binding</span><span class="p">.</span><span class="nx">detachRendering</span><span class="p">();</span>
      <span class="nx">activeRendering</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>

      <span class="nx">itemMenu</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
      <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
      <span class="nx">handleSet</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
      <span class="nx">midDrag</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="nx">handleCalculationData</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">ul</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;nw&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
      <span class="nx">top</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
      <span class="nx">ur</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;ne&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
      <span class="nx">rgt</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
      <span class="nx">lr</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;se&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
      <span class="nx">btm</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
      <span class="nx">ll</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;sw&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
      <span class="nx">lft</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
      <span class="nx">mid</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;pointer&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="p">};</span></pre></div></td></tr><tr id="section-34"><td class="docs"><div class="pilwrap"><a href="#section-34" class="pilcrow">&#182;</a></div><p>Goes through handle object array and 
sets each handle box coordinate</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">calcHandles</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-35"><td class="docs"><div class="pilwrap"><a href="#section-35" class="pilcrow">&#182;</a></div><p>calculate where the resize handles
will be located</p>
</td><td class="code"><div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">calcHandle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">xn</span><span class="p">,</span> <span class="nx">xp</span><span class="p">,</span> <span class="nx">yn</span><span class="p">,</span> <span class="nx">yp</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="nx">x</span><span class="o">:</span> <span class="nx">args</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">xn</span> <span class="o">*</span> <span class="nx">args</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">xp</span> <span class="o">*</span> <span class="nx">padding</span><span class="p">,</span>
          <span class="nx">y</span><span class="o">:</span> <span class="nx">args</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">yn</span> <span class="o">*</span> <span class="nx">args</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">yp</span> <span class="o">*</span> <span class="nx">padding</span><span class="p">,</span>
          <span class="nx">cursor</span><span class="o">:</span> <span class="nx">type</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">?</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">type</span> <span class="o">+</span> <span class="s2">&quot;-resize&quot;</span>
        <span class="p">};</span>
      <span class="p">},</span>
      <span class="nx">recalcHandle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">info</span><span class="p">,</span> <span class="nx">xn</span><span class="p">,</span> <span class="nx">xp</span><span class="p">,</span> <span class="nx">yn</span><span class="p">,</span> <span class="nx">yp</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">el</span><span class="p">;</span>
        <span class="nx">info</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">xn</span> <span class="o">*</span> <span class="nx">args</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">xp</span> <span class="o">*</span> <span class="nx">padding</span><span class="p">;</span>
        <span class="nx">info</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">yn</span> <span class="o">*</span> <span class="nx">args</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">yp</span> <span class="o">*</span> <span class="nx">padding</span><span class="p">;</span>
        <span class="nx">el</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">getById</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
          <span class="nx">x</span><span class="o">:</span> <span class="nx">info</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
          <span class="nx">y</span><span class="o">:</span> <span class="nx">info</span><span class="p">.</span><span class="nx">y</span>
        <span class="p">});</span>
      <span class="p">};</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">dirs</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">handleCalculationData</span><span class="p">[</span><span class="nx">o</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">data</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">handles</span><span class="p">[</span><span class="nx">o</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">handles</span><span class="p">[</span><span class="nx">o</span><span class="p">]</span> <span class="o">=</span> <span class="nx">calcHandle</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nx">recalcHandle</span><span class="p">(</span><span class="nx">handles</span><span class="p">[</span><span class="nx">o</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">};</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
<span class="p">};</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Wed Apr 11 2012 13:12:16 GMT-0400 (EDT)  </div><div id="projectname"><a href="../index.html">OAC Video Annotation Client</a></div></div></body></html>