---
layout: docco
title: OACVideoAnnotator/code/src/component.coffee.html
---
<div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../index.html" class="source"><span class="file_name">README</span></a><a href="../src/application.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">application.coffee</span></a><a href="../src/component.coffee.html" class="source selected"><span class="base_path">src / </span><span class="file_name">component.coffee</span></a><a href="../src/controller.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">controller.coffee</span></a><a href="../src/driver-framework.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">driver-framework.coffee</span></a><a href="../src/drivers/dummy.coffee.html" class="source "><span class="base_path">src / drivers / </span><span class="file_name">dummy.coffee</span></a><a href="../src/drivers/html5.coffee.html" class="source "><span class="base_path">src / drivers / </span><span class="file_name">html5.coffee</span></a><a href="../src/intro.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">intro.coffee</span></a><a href="../src/outro.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">outro.coffee</span></a><a href="../src/presentation.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">presentation.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>component.coffee</h1><div class="filepath">src/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><h1>Components</h1>
</td><td class="code"><div class="highlight"><pre><span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">namespace</span> <span class="s">&quot;Component&quot;</span><span class="p">,</span> <span class="nf">(Component) -&gt;</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><h2>ModeButton</h2>

<p>Manages a modal button connected to the Video Annotator application's CurrentMode variable.</p>

<p>Options:</p>

<ul>
<li><p>application - a callback that returns the application instance</p></li>
<li><p>mode - a string indicating the application mode</p></li>
</ul>

<hr />
</td><td class="code"><div class="highlight"><pre>  <span class="nx">Component</span><span class="p">.</span><span class="nx">namespace</span> <span class="s">&quot;ModeButton&quot;</span><span class="p">,</span> <span class="nf">(ModeButton) -&gt;</span>
    <span class="nv">ModeButton.initInstance = </span><span class="nf">(args...) -&gt;</span>
      <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">initInstance</span> <span class="s">&quot;OAC.Client.StreamingVideo.Component.ModeButton&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">...,</span> <span class="nf">(that, buttonEl) -&gt;</span>
        <span class="nv">options = </span><span class="nx">that</span><span class="p">.</span><span class="nx">options</span>
        <span class="nv">app = </span><span class="nx">options</span><span class="p">.</span><span class="nx">application</span><span class="p">()</span>
        </pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>If the button is clicked and it isn't the current mode, then it is made the current mode.
Otherwise, if it is the current mode, then the current mode is made undefined. The effect is
that the button is a toggle for its mode.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">$</span><span class="p">(</span><span class="nx">buttonEl</span><span class="p">).</span><span class="nx">mousedown</span> <span class="o">-&gt;</span>
          <span class="k">if</span> <span class="nx">$</span><span class="p">(</span><span class="nx">buttonEl</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s">&quot;active&quot;</span><span class="p">)</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">setCurrentMode</span> <span class="kc">null</span>
          <span class="k">else</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">setCurrentMode</span> <span class="nx">options</span><span class="p">.</span><span class="nx">mode</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>We listen for changes in the current application mode and reflect them in the button's
CSS class.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">app</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onCurrentModeChange</span><span class="p">.</span><span class="nx">addListener</span> <span class="nf">(action) -&gt;</span>
          <span class="k">if</span> <span class="nx">action</span> <span class="o">==</span> <span class="nx">options</span><span class="p">.</span><span class="nx">mode</span>
            <span class="nx">$</span><span class="p">(</span><span class="nx">buttonEl</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&quot;active&quot;</span><span class="p">)</span>
          <span class="k">else</span>
            <span class="nx">$</span><span class="p">(</span><span class="nx">buttonEl</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&quot;active&quot;</span><span class="p">)</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><h2>ShapeEditBox</h2>

<p>Creates and manages a SVG bounding box with resize handles and center drag handle.</p>

<p>Options:</p>

<hr />
</td><td class="code"><div class="highlight"><pre>  <span class="nx">Component</span><span class="p">.</span><span class="nx">namespace</span> <span class="s">&quot;ShapeEditBox&quot;</span><span class="p">,</span> <span class="nf">(ShapeEditBox) -&gt;</span>
    <span class="nv">dragController = </span><span class="kc">null</span>
    

    <span class="nv">ShapeEditBox.initInstance = </span><span class="nf">(args...) -&gt;</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>We delay creating the drag controller until we need it because we haven't defined the MITHGrid
defaults for the binding events.</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">dragController</span> <span class="o">?=</span> <span class="nx">OAC</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">StreamingVideo</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">Drag</span><span class="p">.</span><span class="nx">initInstance</span> <span class="p">{}</span>
      <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">initInstance</span> <span class="s">&quot;OAC.Client.StreamingVideo.Component.ShapeEditBox&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">...,</span> <span class="nf">(that, paper) -&gt;</span>
        <span class="nv">options = </span><span class="nx">that</span><span class="p">.</span><span class="nx">options</span>
        <span class="nv">handleSet = </span><span class="kc">null</span>
        <span class="nv">handles = </span><span class="p">{}</span>
        <span class="nv">activeRendering = </span><span class="kc">null</span>
        <span class="nv">attrs = </span><span class="p">{}</span>
        <span class="nv">shapeAttrs = </span><span class="p">{}</span>
        <span class="nv">handleAttrs = </span><span class="p">{}</span>
        <span class="nv">extents = </span><span class="p">{}</span>
        <span class="nv">factors = </span><span class="p">{}</span>
        <span class="nv">svgBBox = </span><span class="kc">null</span>
        <span class="nv">midDrag = </span><span class="kc">null</span>
        <span class="nv">handleSize = </span><span class="mi">5</span>
        <span class="nv">dirs = </span><span class="nx">options</span><span class="p">.</span><span class="nx">dirs</span>
  
        <span class="nv">handleCalculationData =</span>
          <span class="nv">ul: </span> <span class="p">[</span><span class="s">&#39;nw&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
          <span class="nv">top: </span><span class="p">[</span><span class="s">&#39;n&#39;</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
          <span class="nv">ur: </span> <span class="p">[</span><span class="s">&#39;ne&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
          <span class="nv">rgt: </span><span class="p">[</span><span class="s">&#39;e&#39;</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
          <span class="nv">lr: </span> <span class="p">[</span><span class="s">&#39;se&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
          <span class="nv">btm: </span><span class="p">[</span><span class="s">&#39;s&#39;</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
          <span class="nv">ll: </span> <span class="p">[</span><span class="s">&#39;sw&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
          <span class="nv">lft: </span><span class="p">[</span><span class="s">&#39;w&#39;</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
          <span class="nv">mid: </span><span class="p">[</span><span class="s">&#39;pointer&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><h3>calcXYHeightWidth (private)</h3>

<p>Translates the top-left, bottom-right dx/dy information we're tracking as part of the
handle drag operation into the x/y width/height needed to draw the bounding box. This
allows the mouse to move such that we "flip" the box around (e.g., the left side becomes
the right side).</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">calcXYHeightWidth = </span><span class="nf">(args) -&gt;</span>
          <span class="nv">brx = </span><span class="nx">args</span><span class="p">.</span><span class="nx">brx</span>
          <span class="nv">tlx = </span><span class="nx">args</span><span class="p">.</span><span class="nx">tlx</span>
          <span class="nv">bry = </span><span class="nx">args</span><span class="p">.</span><span class="nx">bry</span>
          <span class="nv">tly = </span><span class="nx">args</span><span class="p">.</span><span class="nx">tly</span>
          <span class="k">if</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">y</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="nx">tlx</span> <span class="o">+=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">dx</span>
            <span class="nx">brx</span> <span class="o">+=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">dx</span>
            <span class="nx">tly</span> <span class="o">+=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">dy</span>
            <span class="nx">bry</span> <span class="o">+=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">dy</span>
          <span class="k">else</span> 
            <span class="k">if</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">0</span>
              <span class="nx">tlx</span> <span class="o">+=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">dx</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span>
              <span class="nx">brx</span> <span class="o">+=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">dx</span>
            <span class="k">if</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">0</span>
              <span class="nx">tly</span> <span class="o">+=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">dy</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="mi">0</span>
              <span class="nx">bry</span> <span class="o">+=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">dy</span>
          <span class="k">if</span> <span class="nx">brx</span> <span class="o">&gt;</span> <span class="nx">tlx</span>
            <span class="nv">args.x = </span><span class="nx">tlx</span>
          <span class="k">else</span>
            <span class="nv">args.x = </span><span class="nx">brx</span>
          <span class="k">if</span> <span class="nx">bry</span> <span class="o">&gt;</span> <span class="nx">tly</span>
            <span class="nv">args.y = </span><span class="nx">tly</span>
          <span class="k">else</span>
            <span class="nv">args.y = </span><span class="nx">bry</span>
        
          <span class="nv">args.width = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">brx</span> <span class="o">-</span> <span class="nx">tlx</span><span class="p">)</span>
          <span class="nv">args.height = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">bry</span> <span class="o">-</span> <span class="nx">tly</span><span class="p">)</span>
          <span class="nx">args</span>
          </pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><h3>calcHandles (private)</h3>

<p>Calculates the positions of each of the bounding box resize/move handles given the
object holding the drag information.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">calcHandles = </span><span class="nf">(args) -&gt;</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>calculate where the resize handles
will be located</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">calcXYHeightWidth</span> <span class="nx">args</span>
          
          <span class="nv">calcHandle = </span><span class="nf">(type, xn, yn) -&gt;</span>
            <span class="nv">x: </span><span class="nx">args</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">xn</span> <span class="o">*</span> <span class="nx">args</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">handleSize</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="nv">y: </span><span class="nx">args</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">yn</span> <span class="o">*</span> <span class="nx">args</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">handleSize</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="nv">cursor: </span><span class="k">if</span> <span class="nx">type</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">then</span> <span class="nx">type</span> <span class="k">else</span> <span class="nx">type</span> <span class="o">+</span> <span class="s">&quot;-resize&quot;</span>

          <span class="nv">recalcHandle = </span><span class="nf">(info, xn, yn) -&gt;</span>
            <span class="nv">info.x = </span><span class="nx">args</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">xn</span> <span class="o">*</span> <span class="nx">args</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">handleSize</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="nv">info.y = </span><span class="nx">args</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">yn</span> <span class="o">*</span> <span class="nx">args</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">handleSize</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="nx">info</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">attr</span>
              <span class="nv">x: </span><span class="nx">info</span><span class="p">.</span><span class="nx">x</span>
              <span class="nv">y: </span><span class="nx">info</span><span class="p">.</span><span class="nx">y</span>

          <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">dirs</span>
            <span class="nv">data = </span><span class="nx">handleCalculationData</span><span class="p">[</span><span class="nx">o</span><span class="p">]</span>
            <span class="k">if</span> <span class="nx">data</span><span class="o">?</span>
              <span class="k">if</span> <span class="nx">handles</span><span class="p">[</span><span class="nx">o</span><span class="p">]</span><span class="o">?</span>
                <span class="nx">recalcHandle</span><span class="p">(</span><span class="nx">handles</span><span class="p">[</span><span class="nx">o</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
              <span class="k">else</span>
                <span class="nx">handles</span><span class="p">[</span><span class="nx">o</span><span class="p">]</span> <span class="o">=</span> <span class="nx">calcHandle</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        </pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><h3>calcFactors (private)</h3>

<p>Sets up object for tracking drag-related information based on the extents of the
currently active rendering.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">calcFactors = </span><span class="o">-&gt;</span>
          <span class="nv">extents = </span><span class="nx">activeRendering</span><span class="p">.</span><span class="nx">getExtents</span><span class="p">()</span>
        
          <span class="nv">attrs =</span>
            <span class="nv">tlx: </span><span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="nv">tly: </span><span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="nv">brx: </span><span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="nv">bry: </span><span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">extents</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="nv">dx: </span><span class="mi">0</span>
            <span class="nv">dy: </span><span class="mi">0</span>
          
          <span class="nx">calcHandles</span> <span class="nx">attrs</span>
  </pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><h3>drawHandles (private)</h3>

<p>Draws the handles defined in dirs as SVG rectangles and draws the SVG bounding box.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">drawHandles = </span><span class="o">-&gt;</span>
          <span class="k">if</span> <span class="o">not</span> <span class="nx">handleSet</span><span class="o">?</span>

            <span class="nv">handleSet = </span><span class="nx">paper</span><span class="p">.</span><span class="nx">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">o</span> <span class="k">of</span> <span class="nx">handles</span>
              <span class="k">if</span> <span class="nx">i</span> <span class="o">==</span> <span class="s">&#39;mid&#39;</span>
                <span class="nv">midDrag = </span><span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">handleSize</span><span class="p">,</span> <span class="nx">handleSize</span><span class="p">)</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">midDrag</span><span class="p">.</span><span class="nx">node</span><span class="p">).</span><span class="nx">css</span>
                  <span class="s">&quot;pointer-events&quot;</span><span class="o">:</span> <span class="s">&quot;auto&quot;</span>
                <span class="nv">o.id = </span><span class="nx">midDrag</span><span class="p">.</span><span class="nx">id</span>
                <span class="nv">o.el = </span><span class="nx">midDrag</span>
              <span class="k">else</span>
                <span class="nv">h = </span><span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">handleSize</span><span class="p">,</span> <span class="nx">handleSize</span><span class="p">)</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">h</span><span class="p">.</span><span class="nx">node</span><span class="p">).</span><span class="nx">css</span>
                  <span class="s">&quot;pointer-events&quot;</span><span class="o">:</span> <span class="s">&quot;auto&quot;</span>
                <span class="nv">o.id = </span><span class="nx">h</span><span class="p">.</span><span class="nx">id</span>
                <span class="nv">o.el = </span><span class="nx">h</span>
                <span class="nx">h</span><span class="p">.</span><span class="nx">attr</span>
                  <span class="nv">cursor: </span><span class="nx">o</span><span class="p">.</span><span class="nx">cursor</span>
                <span class="nx">handleSet</span><span class="p">.</span><span class="nx">push</span> <span class="nx">h</span>

            <span class="nx">handleSet</span><span class="p">.</span><span class="nx">attr</span>
              <span class="nv">fill: </span><span class="s">&#39;black&#39;</span>
              <span class="nv">stroke: </span><span class="s">&#39;black&#39;</span>

            <span class="k">if</span> <span class="o">not</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span> <span class="nx">midDrag</span>
              <span class="nx">midDrag</span><span class="p">.</span><span class="nx">attr</span>
                <span class="nv">fill: </span><span class="s">&#39;black&#39;</span>
                <span class="nv">stroke: </span><span class="s">&#39;black&#39;</span>
                <span class="nv">cursor: </span><span class="s">&#39;move&#39;</span>

            <span class="nx">calcXYHeightWidth</span> <span class="nx">attrs</span>
            
            <span class="nv">svgBBox = </span><span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
            <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span>
              <span class="nv">stroke: </span><span class="s">&#39;#333333&#39;</span>
              <span class="s">&#39;stroke-dasharray&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s">&quot;--&quot;</span><span class="p">]</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Bind the middle drag handle to the drag controller.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="nx">midDrag</span><span class="o">?</span>
              <span class="nv">midDragDragBinding = </span><span class="nx">dragController</span><span class="p">.</span><span class="nx">bind</span> <span class="nx">midDrag</span>

              <span class="nx">midDragDragBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUpdate</span><span class="p">.</span><span class="nx">addListener</span> <span class="nf">(dx, dy) -&gt;</span>      
                <span class="nv">attrs.dx = </span><span class="nx">dx</span>
                <span class="nv">attrs.dy = </span><span class="nx">dy</span>

                <span class="nx">calcHandles</span> <span class="nx">attrs</span>
        
                <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span>
                  <span class="nv">x: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span>
                  <span class="nv">y: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span>

              <span class="nx">midDragDragBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onFocus</span><span class="p">.</span><span class="nx">addListener</span> <span class="nf">(x, y) -&gt;</span>
                  <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onFocus</span><span class="p">.</span><span class="nx">fire</span><span class="p">()</span>
                  <span class="nv">factors.x = </span><span class="mi">0</span>
                  <span class="nv">factors.y = </span><span class="mi">0</span>
                  <span class="nx">calcFactors</span><span class="p">()</span>
                  <span class="nx">activeRendering</span><span class="p">.</span><span class="nx">shape</span><span class="p">.</span><span class="nx">attr</span>
                    <span class="nv">cursor: </span><span class="s">&#39;move&#39;</span>
        
              <span class="nx">midDragDragBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUnfocus</span><span class="p">.</span><span class="nx">addListener</span> <span class="o">-&gt;</span>
                  <span class="nx">calcXYHeightWidth</span> <span class="nx">attrs</span>
                  <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onMove</span><span class="p">.</span><span class="nx">fire</span>
                    <span class="nv">x: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="mi">2</span>
                    <span class="nv">y: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">2</span>
                  <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUnfocus</span><span class="p">.</span><span class="nx">fire</span><span class="p">()</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Bind each of the boundary handles to the drag controller.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">handleSet</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(handle) -&gt;</span>
              <span class="nv">handleBinding = </span><span class="nx">dragController</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">handle</span><span class="p">)</span>
        
              <span class="nx">handleBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUpdate</span><span class="p">.</span><span class="nx">addListener</span> <span class="nf">(dx, dy) -&gt;</span>
                <span class="nv">attrs.dx = </span><span class="nx">dx</span>
                <span class="nv">attrs.dy = </span><span class="nx">dy</span>

                <span class="nx">calcHandles</span> <span class="nx">attrs</span>
                
                <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span>
                  <span class="nv">x: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span>
                  <span class="nv">y: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span>
                  <span class="nv">width: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span>
                  <span class="nv">height: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>

              <span class="nx">handleBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onFocus</span><span class="p">.</span><span class="nx">addListener</span> <span class="nf">(x, y) -&gt;</span>
                <span class="nv">extents = </span><span class="nx">activeRendering</span><span class="p">.</span><span class="nx">getExtents</span><span class="p">()</span>

                <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onFocus</span><span class="p">.</span><span class="nx">fire</span><span class="p">()</span>

                <span class="nv">px = </span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span>
                <span class="nv">py = </span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">/</span> <span class="nx">extents</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span>
                <span class="k">if</span> <span class="nx">px</span> <span class="o">&lt;</span> <span class="mi">3</span>
                  <span class="nv">factors.x = </span><span class="o">-</span><span class="mi">1</span>
                <span class="k">else</span> <span class="k">if</span> <span class="nx">px</span> <span class="o">&lt;</span> <span class="mi">5</span>
                  <span class="nv">factors.x = </span><span class="mi">0</span>
                <span class="k">else</span>
                  <span class="nv">factors.x = </span><span class="mi">1</span>
                <span class="k">if</span> <span class="nx">py</span> <span class="o">&lt;</span> <span class="mi">3</span>
                  <span class="nv">factors.y = </span><span class="o">-</span><span class="mi">1</span>
                <span class="k">else</span> <span class="k">if</span> <span class="nx">py</span> <span class="o">&lt;</span> <span class="mi">5</span>
                  <span class="nv">factors.y = </span><span class="mi">0</span>
                <span class="k">else</span>
                  <span class="nv">factors.y = </span><span class="mi">1</span>
                <span class="nx">calcFactors</span><span class="p">()</span>
        
              <span class="nx">handleBinding</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUnfocus</span><span class="p">.</span><span class="nx">addListener</span> <span class="o">-&gt;</span>
                <span class="nx">calcXYHeightWidth</span> <span class="nx">attrs</span>
                </pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>We pass along the center and size to the listener instead of the
top-left and size.</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onResize</span><span class="p">.</span><span class="nx">fire</span>
                  <span class="nv">x: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="mi">2</span>
                  <span class="nv">y: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">2</span>
                  <span class="nv">width: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span>
                  <span class="nv">height: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
                  
                <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">onUnfocus</span><span class="p">.</span><span class="nx">fire</span><span class="p">()</span>
              
              <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">toFront</span><span class="p">()</span>
              <span class="nx">handleSet</span><span class="p">.</span><span class="nx">toFront</span><span class="p">()</span>
              <span class="nx">midDrag</span><span class="p">.</span><span class="nx">toFront</span><span class="p">()</span>
          <span class="k">else</span>
            <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">show</span><span class="p">().</span><span class="nx">toFront</span><span class="p">()</span>

            <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span>
              <span class="nv">x: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span>
              <span class="nv">y: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span>
              <span class="nv">width: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span>
              <span class="nv">height: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
              
            <span class="nx">handleSet</span><span class="p">.</span><span class="nx">show</span><span class="p">().</span><span class="nx">toFront</span><span class="p">()</span>
            <span class="nx">midDrag</span><span class="p">.</span><span class="nx">show</span><span class="p">().</span><span class="nx">toFront</span><span class="p">()</span>
  </pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><h3>#show</h3>

<p>Makes the bounding box visible.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">that.show = </span><span class="o">-&gt;</span>
          <span class="nx">calcFactors</span><span class="p">()</span>
          <span class="nx">drawHandles</span><span class="p">()</span>
  </pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><h3>#hide</h3>

<p>Makes the bounding box invisible.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">that.hide = </span><span class="o">-&gt;</span>
          <span class="k">if</span> <span class="o">not</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isEmptyObject</span> <span class="nx">handleSet</span>
            <span class="nx">handleSet</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
            <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
            <span class="nx">midDrag</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
        </pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><h3>#attachToRendering</h3>

<p>Records the rendering as the currently active rendering and makes sure the bounding box is visible.</p>

<p>Parameters:</p>

<ul>
<li>newRendering - the currently active rendering</li>
</ul>

<p>Returns: Nothing.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">that.attachToRendering = </span><span class="nf">(newRendering) -&gt;</span>
          <span class="nx">that</span><span class="p">.</span><span class="nx">detachFromRendering</span><span class="p">()</span>

          <span class="k">if</span> <span class="o">!</span><span class="nx">newRendering</span><span class="o">?</span>
            <span class="k">return</span>

          <span class="nv">activeRendering = </span><span class="nx">newRendering</span>
          <span class="nx">that</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><h3>#detachFromRendering</h3>

<p>Hides the bounding box and forgets the currently active rendering.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">that.detachFromRendering = </span><span class="nf">() -&gt;</span>
          <span class="nv">activeRendering = </span><span class="kc">null</span>
          <span class="nx">that</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><h2>ShapeCreateBox</h2>

<p>Draws and manages the bounding box used to create a new annotation.</p>

<p>The container is the Raphaël paper on which the bounding box is drawn.</p>

<p><strong>TODO:</strong> See if the bindings in the presentation can be moved here and have a simple event from here go back to
the presentation to create the shape.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">Component</span><span class="p">.</span><span class="nx">namespace</span> <span class="s">&#39;ShapeCreateBox&#39;</span><span class="p">,</span> <span class="nf">(ShapeCreateBox) -&gt;</span>
    <span class="nv">ShapeCreateBox.initInstance = </span><span class="nf">(args...) -&gt;</span>
      <span class="nx">MITHGrid</span><span class="p">.</span><span class="nx">initInstance</span> <span class="s">&quot;OAC.Client.StreamingVideo.Component.ShapeCreateBox&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">...,</span> <span class="nf">(that, paper) -&gt;</span>
        <span class="nv">options = </span><span class="nx">that</span><span class="p">.</span><span class="nx">options</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Bounding box is created once in memory - it should be bound to the
canvas/paper object or something that contains more than 1 shape.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">svgBBox = </span><span class="kc">null</span>
        <span class="nv">factors = </span><span class="p">{}</span>
        <span class="nv">attrs = </span><span class="p">{}</span>
        <span class="nv">shapeAttrs = </span><span class="p">{}</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><h3>#createGuide</h3>

<p>Creates the SVGBBOX which acts as a guide to the user
of how big their shape will be once shapeDone is fired</p>

<p>Parameters:</p>

<ul>
<li>coords - object that has x,y coordinates for user mousedown. This is where the left and top of the box will start</li>
</ul>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">that.createGuide = </span><span class="nf">(coords) -&gt;</span>
          <span class="nv">attrs.x = </span><span class="nx">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
          <span class="nv">attrs.y = </span><span class="nx">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="nv">attrs.width = </span><span class="mi">0</span>
          <span class="nv">attrs.height = </span><span class="mi">0</span>
          <span class="k">if</span> <span class="o">not</span> <span class="nx">svgBBox</span><span class="o">?</span>
            <span class="nv">svgBBox = </span><span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
            <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span>
              <span class="nv">stroke: </span><span class="s">&#39;#333333&#39;</span>
              <span class="s">&#39;stroke-dasharray&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s">&quot;--&quot;</span><span class="p">]</span>
          <span class="k">else</span>
            <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>

            <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span>
              <span class="nv">x: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span>
              <span class="nv">y: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span>
              <span class="nv">width: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span>
              <span class="nv">height: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><h3>#resizeGuide</h3>

<p>Resize the bounding box to have the passed coordinates be the opposite corner from the initial
coordinates.</p>

<p>Parameters:</p>

<ul>
<li>coords - array of x,y coordinates to use as bottom-right coords of the box</li>
</ul>

<p>Returns: Nothing.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">that.resizeGuide = </span><span class="nf">(coords) -&gt;</span>
          <span class="nv">attrs.width = </span><span class="p">(</span><span class="nx">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span>
          <span class="nv">attrs.height = </span><span class="p">(</span><span class="nx">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>

          <span class="k">if</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span> <span class="o">&lt;</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span> <span class="o">&lt;</span> <span class="mi">0</span>
              <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span>
                <span class="nv">width: </span><span class="o">-</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span>
                <span class="nv">height: </span><span class="o">-</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
                <span class="nv">x: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span>
                <span class="nv">y: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
            <span class="k">else</span>
              <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span>
                <span class="nv">width: </span><span class="o">-</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span>
                <span class="nv">height: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
                <span class="nv">x: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span>
                <span class="nv">y: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span>
          <span class="k">else</span> <span class="k">if</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span> <span class="o">&lt;</span> <span class="mi">0</span>
            <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span>
              <span class="nv">width: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span>
              <span class="nv">height: </span><span class="o">-</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
              <span class="nv">x: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span>
              <span class="nv">y: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
          <span class="k">else</span>
            <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">attr</span>
              <span class="nv">width: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span>
              <span class="nv">height: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
              <span class="nv">x: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span>
              <span class="nv">y: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><h3>#completeShape</h3>

<p>Take the saved coordinates and pass them back
to the calling function</p>

<p>Parameters:</p>

<ul>
<li>coords - coordinates object with properties x, y, width, and height</li>
</ul>

<p>Returns:
Coordinates object with properties x, y, width, and height</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">that.completeShape = </span><span class="nf">(coords) -&gt;</span>
          <span class="nx">that</span><span class="p">.</span><span class="nx">resizeGuide</span> <span class="nx">coords</span>

          <span class="nx">svgBBox</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
          
          <span class="k">if</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span> <span class="o">&lt;</span> <span class="mi">0</span>
            <span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span>
            <span class="nv">attrs.width = </span><span class="o">-</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span>
          <span class="k">if</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span> <span class="o">&lt;</span> <span class="mi">0</span>
            <span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
            <span class="nv">attrs.height = </span><span class="o">-</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
          <span class="k">return</span> <span class="p">{</span>
            <span class="nv">x: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">x</span>
            <span class="nv">y: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">y</span>
            <span class="nv">width: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span>
            <span class="nv">height: </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span>
          <span class="p">}</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Thu Nov 01 2012 09:41:34 GMT-0400 (EDT)  </div><div id="projectname"><a href="../index.html">Video Annotator</a></div></div>